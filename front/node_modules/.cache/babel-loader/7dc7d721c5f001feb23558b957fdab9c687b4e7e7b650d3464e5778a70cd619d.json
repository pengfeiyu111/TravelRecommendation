{"ast":null,"code":"import { initDepartment, loadDepartment, searchDepartment } from \"@/api/index\";\nexport default {\n  name: \"departmentTreeChoose\",\n  props: {\n    multiple: {\n      type: Boolean,\n      default: false\n    },\n    clearable: {\n      type: Boolean,\n      default: true\n    },\n    placeholder: {\n      type: String,\n      default: \"点击选择部门\"\n    }\n  },\n  data() {\n    return {\n      depLoading: false,\n      departmentTitle: \"\",\n      searchKey: \"\",\n      dataDep: [],\n      selectDep: [],\n      departmentId: []\n    };\n  },\n  methods: {\n    initDepartmentData() {\n      initDepartment().then(res => {\n        if (res.success) {\n          res.result.forEach(function (e) {\n            if (e.isParent) {\n              e.loading = false;\n              e.children = [];\n            }\n            if (e.status == -1) {\n              e.title = \"[已禁用] \" + e.title;\n              e.disabled = true;\n            }\n          });\n          this.dataDep = res.result;\n        }\n      });\n    },\n    loadData(item, callback) {\n      loadDepartment({\n        parentId: item.id\n      }).then(res => {\n        if (res.success) {\n          res.result.forEach(function (e) {\n            if (e.isParent) {\n              e.loading = false;\n              e.children = [];\n            }\n            if (e.status == -1) {\n              e.title = \"[已禁用] \" + e.title;\n              e.disabled = true;\n            }\n          });\n          callback(res.result);\n        }\n      });\n    },\n    searchDep() {\n      // 搜索部门\n      if (this.searchKey) {\n        this.depLoading = true;\n        searchDepartment({\n          title: this.searchKey\n        }).then(res => {\n          this.depLoading = false;\n          if (res.success) {\n            res.result.forEach(function (e) {\n              if (e.status == -1) {\n                e.title = \"[已禁用] \" + e.title;\n                e.disabled = true;\n              }\n            });\n            this.dataDep = res.result;\n          }\n        });\n      } else {\n        this.initDepartmentData();\n      }\n    },\n    selectTree(v) {\n      let ids = [],\n        title = \"\";\n      v.forEach(e => {\n        ids.push(e.id);\n        if (title == \"\") {\n          title = e.title;\n        } else {\n          title = title + \"、\" + e.title;\n        }\n      });\n      this.departmentId = ids;\n      this.departmentTitle = title;\n      if (this.multiple) {\n        this.$emit(\"on-change\", this.departmentId);\n      } else {\n        this.$emit(\"on-change\", this.departmentId[0]);\n      }\n    },\n    clearSelect() {\n      this.departmentId = [];\n      this.departmentTitle = \"\";\n      this.initDepartmentData();\n      if (this.multiple) {\n        this.$emit(\"on-change\", []);\n      } else {\n        this.$emit(\"on-change\", \"\");\n      }\n      this.$emit(\"on-clear\");\n    },\n    setData(ids, title) {\n      this.departmentTitle = title;\n      if (this.multiple) {\n        this.departmentId = ids;\n      } else {\n        this.departmentId = [];\n        this.departmentId.push(ids);\n      }\n      this.$emit(\"on-change\", this.departmentId);\n    }\n  },\n  mounted() {\n    this.initDepartmentData();\n  }\n};","map":{"version":3,"names":["initDepartment","loadDepartment","searchDepartment","name","props","multiple","type","Boolean","default","clearable","placeholder","String","data","depLoading","departmentTitle","searchKey","dataDep","selectDep","departmentId","methods","initDepartmentData","then","res","success","result","forEach","e","isParent","loading","children","status","title","disabled","loadData","item","callback","parentId","id","searchDep","selectTree","v","ids","push","$emit","clearSelect","setData","mounted"],"sources":["src/views/template/department-tree-choose.vue"],"sourcesContent":["<template>\r\n<div>\r\n    <div style=\"display:flex;\">\r\n        <Input v-model=\"departmentTitle\" readonly style=\"margin-right:10px;\" :placeholder=\"placeholder\" :clearable=\"clearable\" @on-clear=\"clearSelect\" />\r\n        <Poptip transfer trigger=\"click\" placement=\"right\" title=\"选择部门\" width=\"250\">\r\n            <Button icon=\"md-list\">选择部门</Button>\r\n            <div slot=\"content\">\r\n                <Input v-model=\"searchKey\" suffix=\"ios-search\" @on-change=\"searchDep\" placeholder=\"输入部门名搜索\" clearable />\r\n                <div class=\"dep-tree-bar\">\r\n                    <Tree :data=\"dataDep\" :load-data=\"loadData\" @on-select-change=\"selectTree\" :multiple=\"multiple\"></Tree>\r\n                    <Spin size=\"large\" fix v-if=\"depLoading\"></Spin>\r\n                </div>\r\n            </div>\r\n        </Poptip>\r\n    </div>\r\n</div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n    initDepartment,\r\n    loadDepartment,\r\n    searchDepartment\r\n} from \"@/api/index\";\r\nexport default {\r\n    name: \"departmentTreeChoose\",\r\n    props: {\r\n        multiple: {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n        clearable: {\r\n            type: Boolean,\r\n            default: true\r\n        },\r\n        placeholder: {\r\n            type: String,\r\n            default: \"点击选择部门\"\r\n        }\r\n    },\r\n    data() {\r\n        return {\r\n            depLoading: false,\r\n            departmentTitle: \"\",\r\n            searchKey: \"\",\r\n            dataDep: [],\r\n            selectDep: [],\r\n            departmentId: []\r\n        };\r\n    },\r\n    methods: {\r\n        initDepartmentData() {\r\n            initDepartment().then(res => {\r\n                if (res.success) {\r\n                    res.result.forEach(function (e) {\r\n                        if (e.isParent) {\r\n                            e.loading = false;\r\n                            e.children = [];\r\n                        }\r\n                        if (e.status == -1) {\r\n                            e.title = \"[已禁用] \" + e.title;\r\n                            e.disabled = true;\r\n                        }\r\n                    });\r\n                    this.dataDep = res.result;\r\n                }\r\n            });\r\n        },\r\n        loadData(item, callback) {\r\n            loadDepartment({\r\n                parentId: item.id\r\n            }).then(res => {\r\n                if (res.success) {\r\n                    res.result.forEach(function (e) {\r\n                        if (e.isParent) {\r\n                            e.loading = false;\r\n                            e.children = [];\r\n                        }\r\n                        if (e.status == -1) {\r\n                            e.title = \"[已禁用] \" + e.title;\r\n                            e.disabled = true;\r\n                        }\r\n                    });\r\n                    callback(res.result);\r\n                }\r\n            });\r\n        },\r\n        searchDep() {\r\n            // 搜索部门\r\n            if (this.searchKey) {\r\n                this.depLoading = true;\r\n                searchDepartment({\r\n                    title: this.searchKey\r\n                }).then(res => {\r\n                    this.depLoading = false;\r\n                    if (res.success) {\r\n                        res.result.forEach(function (e) {\r\n                            if (e.status == -1) {\r\n                                e.title = \"[已禁用] \" + e.title;\r\n                                e.disabled = true;\r\n                            }\r\n                        });\r\n                        this.dataDep = res.result;\r\n                    }\r\n                });\r\n            } else {\r\n                this.initDepartmentData();\r\n            }\r\n        },\r\n        selectTree(v) {\r\n            let ids = [],\r\n                title = \"\";\r\n            v.forEach(e => {\r\n                ids.push(e.id);\r\n                if (title == \"\") {\r\n                    title = e.title;\r\n                } else {\r\n                    title = title + \"、\" + e.title;\r\n                }\r\n            });\r\n            this.departmentId = ids;\r\n            this.departmentTitle = title;\r\n            if (this.multiple) {\r\n                this.$emit(\"on-change\", this.departmentId);\r\n            } else {\r\n                this.$emit(\"on-change\", this.departmentId[0]);\r\n            }\r\n        },\r\n        clearSelect() {\r\n            this.departmentId = [];\r\n            this.departmentTitle = \"\";\r\n            this.initDepartmentData();\r\n            if (this.multiple) {\r\n                this.$emit(\"on-change\", []);\r\n            } else {\r\n                this.$emit(\"on-change\", \"\");\r\n            }\r\n            this.$emit(\"on-clear\");\r\n        },\r\n        setData(ids, title) {\r\n            this.departmentTitle = title;\r\n            if (this.multiple) {\r\n                this.departmentId = ids;\r\n            } else {\r\n                this.departmentId = [];\r\n                this.departmentId.push(ids);\r\n            }\r\n            this.$emit(\"on-change\", this.departmentId);\r\n        }\r\n    },\r\n    mounted() {\r\n        this.initDepartmentData();\r\n    }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\">\r\n.dep-tree-bar {\r\n    position: relative;\r\n    min-height: 80px;\r\n    max-height: 500px;\r\n    overflow: auto;\r\n    margin-top: 5px;\r\n}\r\n\r\n.dep-tree-bar::-webkit-scrollbar {\r\n    width: 6px;\r\n    height: 6px;\r\n}\r\n\r\n.dep-tree-bar::-webkit-scrollbar-thumb {\r\n    border-radius: 4px;\r\n    -webkit-box-shadow: inset 0 0 2px #d1d1d1;\r\n    background: #e4e4e4;\r\n}\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}