{"ast":null,"code":"export default {\n  name: \"tagsPageOpened\",\n  data() {\n    return {\n      currentPageName: this.$route.name,\n      tagBodyLeft: 0,\n      refsTag: [],\n      tagsCount: 1\n    };\n  },\n  props: {\n    pageTagsList: Array,\n    beforePush: {\n      type: Function,\n      default: item => {\n        return true;\n      }\n    }\n  },\n  computed: {\n    title() {\n      return this.$store.state.app.currentTitle;\n    },\n    tagsList() {\n      return this.$store.state.app.pageOpenedList;\n    }\n  },\n  methods: {\n    itemTitle(item) {\n      if (item.name == \"home_index\") {\n        return \"首页\";\n      }\n      return item.title;\n    },\n    closePage(event, name) {\n      let pageOpenedList = this.$store.state.app.pageOpenedList;\n      let lastPageObj = pageOpenedList[0];\n      if (this.currentPageName == name) {\n        let len = pageOpenedList.length;\n        for (let i = 1; i < len; i++) {\n          if (pageOpenedList[i].name == name) {\n            if (i < len - 1) {\n              lastPageObj = pageOpenedList[i + 1];\n            } else {\n              lastPageObj = pageOpenedList[i - 1];\n            }\n            break;\n          }\n        }\n      } else {\n        let tagWidth = event.target.parentNode.offsetWidth;\n        this.tagBodyLeft = Math.min(this.tagBodyLeft + tagWidth, 0);\n      }\n      this.$store.commit(\"removeTag\", name);\n      this.$store.commit(\"closePage\", name);\n      pageOpenedList = this.$store.state.app.pageOpenedList;\n      localStorage.pageOpenedList = JSON.stringify(pageOpenedList);\n      if (this.currentPageName == name) {\n        this.linkTo(lastPageObj);\n      }\n    },\n    linkTo(item) {\n      if (this.$route.name == item.name) {\n        return;\n      }\n      let routerObj = {};\n      routerObj.name = item.name;\n      if (item.argu) {\n        routerObj.params = item.argu;\n      }\n      if (item.query) {\n        routerObj.query = item.query;\n      }\n      if (this.beforePush(item)) {\n        this.$router.push(routerObj);\n      }\n    },\n    handlescroll(e) {\n      var type = e.type;\n      let delta = 0;\n      if (type == \"DOMMouseScroll\" || type == \"mousewheel\") {\n        delta = e.wheelDelta ? e.wheelDelta : -(e.detail || 0) * 40;\n      }\n      let left = 0;\n      if (delta > 0) {\n        left = Math.min(0, this.tagBodyLeft + delta);\n      } else {\n        if (this.$refs.scrollCon.offsetWidth - 100 < this.$refs.scrollBody.offsetWidth) {\n          if (this.tagBodyLeft < -(this.$refs.scrollBody.offsetWidth - this.$refs.scrollCon.offsetWidth + 100)) {\n            left = this.tagBodyLeft;\n          } else {\n            left = Math.max(this.tagBodyLeft + delta, this.$refs.scrollCon.offsetWidth - this.$refs.scrollBody.offsetWidth - 100);\n          }\n        } else {\n          this.tagBodyLeft = 0;\n        }\n      }\n      this.tagBodyLeft = left;\n    },\n    handleTagsOption(type) {\n      if (type == \"clearAll\") {\n        this.$store.commit(\"clearAllTags\");\n        this.$router.push({\n          name: \"home_index\"\n        });\n      } else {\n        this.$store.commit(\"clearOtherTags\", this);\n      }\n      this.tagBodyLeft = 0;\n    },\n    moveToView(tag) {\n      if (tag.offsetLeft < -this.tagBodyLeft) {\n        // 标签在可视区域左侧\n        this.tagBodyLeft = -tag.offsetLeft + 10;\n      } else if (tag.offsetLeft + 10 > -this.tagBodyLeft && tag.offsetLeft + tag.offsetWidth < -this.tagBodyLeft + this.$refs.scrollCon.offsetWidth - 100) {\n        // 标签在可视区域\n        this.tagBodyLeft = Math.min(0, this.$refs.scrollCon.offsetWidth - 100 - tag.offsetWidth - tag.offsetLeft - 20);\n      } else {\n        // 标签在可视区域右侧\n        this.tagBodyLeft = -(tag.offsetLeft - (this.$refs.scrollCon.offsetWidth - 100 - tag.offsetWidth) + 20);\n      }\n    }\n  },\n  mounted() {\n    this.refsTag = this.$refs.tagsPageOpened;\n    setTimeout(() => {\n      this.refsTag.forEach((item, index) => {\n        if (this.$route.name == item.name) {\n          let tag = this.refsTag[index].$el;\n          this.moveToView(tag);\n        }\n      });\n    }, 1); // 这里不设定时器就会有偏移bug\n    this.tagsCount = this.tagsList.length;\n  },\n  watch: {\n    $route(to) {\n      this.currentPageName = to.name;\n      this.$nextTick(() => {\n        this.refsTag.forEach((item, index) => {\n          if (to.name == item.name) {\n            let tag = this.refsTag[index].$el;\n            this.moveToView(tag);\n          }\n        });\n      });\n      this.tagsCount = this.tagsList.length;\n    }\n  }\n};","map":{"version":3,"names":["name","data","currentPageName","$route","tagBodyLeft","refsTag","tagsCount","props","pageTagsList","Array","beforePush","type","Function","default","item","computed","title","$store","state","app","currentTitle","tagsList","pageOpenedList","methods","itemTitle","closePage","event","lastPageObj","len","length","i","tagWidth","target","parentNode","offsetWidth","Math","min","commit","localStorage","JSON","stringify","linkTo","routerObj","argu","params","query","$router","push","handlescroll","e","delta","wheelDelta","detail","left","$refs","scrollCon","scrollBody","max","handleTagsOption","moveToView","tag","offsetLeft","mounted","tagsPageOpened","setTimeout","forEach","index","$el","watch","to","$nextTick"],"sources":["src/views/main-components/tags-page-opened.vue"],"sourcesContent":["<style lang=\"less\">\r\n@import \"../main.less\";\r\n</style>\r\n\r\n<template>\r\n<div ref=\"scrollCon\" @DOMMouseScroll=\"handlescroll\" @mousewheel=\"handlescroll\" class=\"tags-outer-scroll-con\">\r\n    <div class=\"close-all-tag-con\">\r\n        <Dropdown transfer @on-click=\"handleTagsOption\">\r\n            <Button size=\"small\" type=\"primary\">\r\n                关闭菜单\r\n                <Icon type=\"md-arrow-dropdown\"></Icon>\r\n            </Button>\r\n            <DropdownMenu slot=\"list\">\r\n                <DropdownItem name=\"clearAll\">关闭全部</DropdownItem>\r\n                <DropdownItem name=\"clearOthers\">关闭其他</DropdownItem>\r\n            </DropdownMenu>\r\n        </Dropdown>\r\n    </div>\r\n    <div ref=\"scrollBody\" class=\"tags-inner-scroll-body\" :style=\"{left: tagBodyLeft + 'px'}\">\r\n        <transition-group name=\"taglist-moving-animation\">\r\n            <Tag type=\"dot\" v-for=\"(item, index) in pageTagsList\" ref=\"tagsPageOpened\" :key=\"item.name\" :name=\"item.name\" @on-close=\"closePage\" @click.native=\"linkTo(item)\" :closable=\"item.name=='home_index'?false:true\" :color=\"item.children?(item.children[0].name==currentPageName?'primary':'default'):(item.name==currentPageName?'primary':'default')\">{{ item.title }}</Tag>\r\n        </transition-group>\r\n    </div>\r\n</div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    name: \"tagsPageOpened\",\r\n    data() {\r\n        return {\r\n            currentPageName: this.$route.name,\r\n            tagBodyLeft: 0,\r\n            refsTag: [],\r\n            tagsCount: 1\r\n        };\r\n    },\r\n    props: {\r\n        pageTagsList: Array,\r\n        beforePush: {\r\n            type: Function,\r\n            default: item => {\r\n                return true;\r\n            }\r\n        }\r\n    },\r\n    computed: {\r\n        title() {\r\n            return this.$store.state.app.currentTitle;\r\n        },\r\n        tagsList() {\r\n            return this.$store.state.app.pageOpenedList;\r\n        }\r\n    },\r\n    methods: {\r\n        itemTitle(item) {\r\n            if (item.name == \"home_index\") {\r\n                return \"首页\";\r\n            }\r\n            return item.title;\r\n        },\r\n        closePage(event, name) {\r\n            let pageOpenedList = this.$store.state.app.pageOpenedList;\r\n            let lastPageObj = pageOpenedList[0];\r\n            if (this.currentPageName == name) {\r\n                let len = pageOpenedList.length;\r\n                for (let i = 1; i < len; i++) {\r\n                    if (pageOpenedList[i].name == name) {\r\n                        if (i < len - 1) {\r\n                            lastPageObj = pageOpenedList[i + 1];\r\n                        } else {\r\n                            lastPageObj = pageOpenedList[i - 1];\r\n                        }\r\n                        break;\r\n                    }\r\n                }\r\n            } else {\r\n                let tagWidth = event.target.parentNode.offsetWidth;\r\n                this.tagBodyLeft = Math.min(this.tagBodyLeft + tagWidth, 0);\r\n            }\r\n            this.$store.commit(\"removeTag\", name);\r\n            this.$store.commit(\"closePage\", name);\r\n            pageOpenedList = this.$store.state.app.pageOpenedList;\r\n            localStorage.pageOpenedList = JSON.stringify(pageOpenedList);\r\n            if (this.currentPageName == name) {\r\n                this.linkTo(lastPageObj);\r\n            }\r\n        },\r\n        linkTo(item) {\r\n            if (this.$route.name == item.name) {\r\n                return;\r\n            }\r\n            let routerObj = {};\r\n            routerObj.name = item.name;\r\n            if (item.argu) {\r\n                routerObj.params = item.argu;\r\n            }\r\n            if (item.query) {\r\n                routerObj.query = item.query;\r\n            }\r\n            if (this.beforePush(item)) {\r\n                this.$router.push(routerObj);\r\n            }\r\n        },\r\n        handlescroll(e) {\r\n            var type = e.type;\r\n            let delta = 0;\r\n            if (type == \"DOMMouseScroll\" || type == \"mousewheel\") {\r\n                delta = e.wheelDelta ? e.wheelDelta : -(e.detail || 0) * 40;\r\n            }\r\n            let left = 0;\r\n            if (delta > 0) {\r\n                left = Math.min(0, this.tagBodyLeft + delta);\r\n            } else {\r\n                if (\r\n                    this.$refs.scrollCon.offsetWidth - 100 <\r\n                    this.$refs.scrollBody.offsetWidth\r\n                ) {\r\n                    if (\r\n                        this.tagBodyLeft <\r\n                        -(\r\n                            this.$refs.scrollBody.offsetWidth -\r\n                            this.$refs.scrollCon.offsetWidth +\r\n                            100\r\n                        )\r\n                    ) {\r\n                        left = this.tagBodyLeft;\r\n                    } else {\r\n                        left = Math.max(\r\n                            this.tagBodyLeft + delta,\r\n                            this.$refs.scrollCon.offsetWidth -\r\n                            this.$refs.scrollBody.offsetWidth -\r\n                            100\r\n                        );\r\n                    }\r\n                } else {\r\n                    this.tagBodyLeft = 0;\r\n                }\r\n            }\r\n            this.tagBodyLeft = left;\r\n        },\r\n        handleTagsOption(type) {\r\n            if (type == \"clearAll\") {\r\n                this.$store.commit(\"clearAllTags\");\r\n                this.$router.push({\r\n                    name: \"home_index\"\r\n                });\r\n            } else {\r\n                this.$store.commit(\"clearOtherTags\", this);\r\n            }\r\n            this.tagBodyLeft = 0;\r\n        },\r\n        moveToView(tag) {\r\n            if (tag.offsetLeft < -this.tagBodyLeft) {\r\n                // 标签在可视区域左侧\r\n                this.tagBodyLeft = -tag.offsetLeft + 10;\r\n            } else if (\r\n                tag.offsetLeft + 10 > -this.tagBodyLeft &&\r\n                tag.offsetLeft + tag.offsetWidth <\r\n                -this.tagBodyLeft + this.$refs.scrollCon.offsetWidth - 100\r\n            ) {\r\n                // 标签在可视区域\r\n                this.tagBodyLeft = Math.min(\r\n                    0,\r\n                    this.$refs.scrollCon.offsetWidth -\r\n                    100 -\r\n                    tag.offsetWidth -\r\n                    tag.offsetLeft -\r\n                    20\r\n                );\r\n            } else {\r\n                // 标签在可视区域右侧\r\n                this.tagBodyLeft = -(\r\n                    tag.offsetLeft -\r\n                    (this.$refs.scrollCon.offsetWidth - 100 - tag.offsetWidth) +\r\n                    20\r\n                );\r\n            }\r\n        }\r\n    },\r\n    mounted() {\r\n        this.refsTag = this.$refs.tagsPageOpened;\r\n        setTimeout(() => {\r\n            this.refsTag.forEach((item, index) => {\r\n                if (this.$route.name == item.name) {\r\n                    let tag = this.refsTag[index].$el;\r\n                    this.moveToView(tag);\r\n                }\r\n            });\r\n        }, 1); // 这里不设定时器就会有偏移bug\r\n        this.tagsCount = this.tagsList.length;\r\n    },\r\n    watch: {\r\n        $route(to) {\r\n            this.currentPageName = to.name;\r\n            this.$nextTick(() => {\r\n                this.refsTag.forEach((item, index) => {\r\n                    if (to.name == item.name) {\r\n                        let tag = this.refsTag[index].$el;\r\n                        this.moveToView(tag);\r\n                    }\r\n                });\r\n            });\r\n            this.tagsCount = this.tagsList.length;\r\n        }\r\n    }\r\n};\r\n</script>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}