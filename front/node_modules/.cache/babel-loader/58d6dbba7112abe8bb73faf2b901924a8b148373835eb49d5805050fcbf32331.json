{"ast":null,"code":"import { getAllRoleList, addUser, editUser } from \"./api.js\";\nimport { validateUsername, validateMobile, validatePassword } from \"@/libs/validate\";\nimport departmentTreeChoose from \"@/views/template/department-tree-choose\";\nimport uploadPicInput from \"@/views/template/upload-pic-input\";\nimport SetPassword from \"@/views/template/set-password\";\nimport dict from \"@/views/template/dict\";\nexport default {\n  name: \"user\",\n  components: {\n    departmentTreeChoose,\n    uploadPicInput,\n    SetPassword,\n    dict\n  },\n  props: {\n    value: {\n      type: Boolean,\n      default: false\n    },\n    data: {\n      type: Object\n    },\n    type: {\n      type: String,\n      default: \"0\"\n    }\n  },\n  data() {\n    return {\n      visible: this.value,\n      title: \"\",\n      passColor: \"\",\n      submitLoading: false,\n      form: {\n        addressArray: []\n      },\n      formValidate: {\n        username: [{\n          required: true,\n          message: \"请输入登录账号\",\n          trigger: \"blur\"\n        }, {\n          validator: validateUsername,\n          trigger: \"blur\"\n        }],\n        nickname: [{\n          required: true,\n          message: \"请输入用户名\",\n          trigger: \"blur\"\n        }],\n        mobile: [{\n          required: true,\n          message: \"请输入手机号\",\n          trigger: \"blur\"\n        }, {\n          validator: validateMobile,\n          trigger: \"blur\"\n        }],\n        password: [{\n          required: true,\n          message: \"请输入密码\",\n          trigger: \"blur\"\n        }, {\n          validator: validatePassword,\n          trigger: \"blur\"\n        }],\n        email: [{\n          required: true,\n          message: \"请输入邮箱地址\"\n        }, {\n          type: \"email\",\n          message: \"邮箱格式不正确\"\n        }]\n      },\n      roleList: []\n    };\n  },\n  methods: {\n    init() {\n      this.getRoleList();\n    },\n    getRoleList() {\n      getAllRoleList().then(res => {\n        if (res.success) {\n          this.roleList = res.result;\n        }\n      });\n    },\n    handleSelectDepTree(v) {\n      this.form.departmentId = v;\n    },\n    changeAddress(v) {\n      this.form.address = JSON.stringify(this.form.addressArray);\n    },\n    changePass(v, grade, strength) {\n      this.form.passStrength = strength;\n    },\n    submit() {\n      this.$refs.form.validate(valid => {\n        if (valid) {\n          if (this.type == \"1\") {\n            this.submitLoading = true;\n            editUser(this.form).then(res => {\n              this.submitLoading = false;\n              if (res.success) {\n                this.$Message.success(\"操作成功\");\n                this.$emit(\"on-submit\", true);\n                this.visible = false;\n              }\n            });\n          } else {\n            this.submitLoading = true;\n            addUser(this.form).then(res => {\n              this.submitLoading = false;\n              if (res.success) {\n                this.$Message.success(\"操作成功\");\n                this.$emit(\"on-submit\", true);\n                this.visible = false;\n              }\n            });\n          }\n        }\n      });\n    },\n    setCurrentValue(value) {\n      if (value === this.visible) {\n        return;\n      }\n      if (this.type == \"1\") {\n        this.title = \"编辑\";\n      } else if (this.type == \"2\") {\n        this.title = \"添加\";\n      } else {\n        this.title = \"详情\";\n      }\n      this.$refs.form.resetFields();\n      if (this.type == \"0\" || this.type == \"1\") {\n        // 回显数据\n        let data = this.data;\n        // 地址\n        if (data.address) {\n          data.addressArray = JSON.parse(data.address);\n        } else {\n          data.addressArray = [];\n        }\n        // 部门\n        this.$refs.depTree.setData(data.departmentId, data.departmentTitle);\n        // 角色\n        let selectRolesId = [];\n        data.roles.forEach(function (e) {\n          selectRolesId.push(e.id);\n        });\n        data.roleIds = selectRolesId;\n        delete data.roles;\n        delete data.permissions;\n        // 密码强度\n        if (data.passStrength == \"弱\") {\n          this.passColor = \"#ed3f14\";\n        } else if (data.passStrength == \"中\") {\n          this.passColor = \"#faad14\";\n        } else if (data.passStrength == \"强\") {\n          this.passColor = \"#52c41a\";\n        }\n        // 回显\n        this.form = data;\n      } else {\n        // 添加\n        this.$refs.depTree.setData(\"\", \"\");\n        this.form = {\n          type: 0,\n          sex: \"\",\n          addressArray: []\n        };\n      }\n      this.visible = value;\n    }\n  },\n  watch: {\n    value(val) {\n      this.setCurrentValue(val);\n    },\n    visible(value) {\n      this.$emit(\"input\", value);\n    }\n  },\n  mounted() {\n    this.init();\n  }\n};","map":{"version":3,"names":["getAllRoleList","addUser","editUser","validateUsername","validateMobile","validatePassword","departmentTreeChoose","uploadPicInput","SetPassword","dict","name","components","props","value","type","Boolean","default","data","Object","String","visible","title","passColor","submitLoading","form","addressArray","formValidate","username","required","message","trigger","validator","nickname","mobile","password","email","roleList","methods","init","getRoleList","then","res","success","result","handleSelectDepTree","v","departmentId","changeAddress","address","JSON","stringify","changePass","grade","strength","passStrength","submit","$refs","validate","valid","$Message","$emit","setCurrentValue","resetFields","parse","depTree","setData","departmentTitle","selectRolesId","roles","forEach","e","push","id","roleIds","permissions","sex","watch","val","mounted"],"sources":["src/views/roster/user/addEdit.vue"],"sourcesContent":["<template>\r\n<div class=\"user-edit\">\r\n    <Modal :title=\"title\" v-model=\"visible\" width=\"90\" draggable :mask-closable=\"type=='0'\" ok-text=\"确认提交\" @on-ok=\"submit\">\r\n\r\n        <Row :gutter=\"16\" justify=\"center\">\r\n            <div class=\"info-title\"><span v-show=\"type!='2'\">登录账号{{form.username}}（唯一标识{{form.id}}） </span>\r\n                <Icon v-show=\"form.status==-1\" type=\"md-lock\" size=\"18\" style=\"margin-left:10px;cursor:pointer\" />\r\n            </div>\r\n        </Row>\r\n        <Form ref=\"form\" :model=\"form\" :rules=\"formValidate\" label-position=\"top\">\r\n            <Row :gutter=\"16\" v-if=\"type=='2'\">\r\n                <Col span=\"12\">\r\n                <FormItem label=\"登录账号\" prop=\"username\" style=\"width:100%\">\r\n                    <Input v-model=\"form.username\" autocomplete=\"off\" :maxlength=\"16\" />\r\n                </FormItem>\r\n                </Col>\r\n                <Col span=\"12\">\r\n                <FormItem label=\"密码\" prop=\"password\" style=\"width:100%\">\r\n                    <SetPassword v-model=\"form.password\" @on-change=\"changePass\" />\r\n                </FormItem>\r\n                </Col>\r\n            </Row>\r\n            <Row :gutter=\"16\">\r\n                <Col span=\"12\">\r\n                <FormItem label=\"用户名\" prop=\"nickname\" style=\"width:100%\">\r\n                    <Input v-model=\"form.nickname\" />\r\n                </FormItem>\r\n                </Col>\r\n                <Col span=\"12\">\r\n                <FormItem label=\"邮箱\" prop=\"email\" style=\"width:100%\">\r\n                    <Input v-model=\"form.email\" />\r\n                </FormItem>\r\n                </Col>\r\n            </Row>\r\n            <Row :gutter=\"16\">\r\n                <Col span=\"12\">\r\n                <FormItem label=\"手机号\" prop=\"mobile\" style=\"width:100%\">\r\n                    <Input v-model=\"form.mobile\" />\r\n                </FormItem>\r\n                </Col>\r\n                <Col span=\"12\">\r\n                <FormItem label=\"性别\" style=\"width:100%\">\r\n                    <dict dict=\"sex\" v-model=\"form.sex\" transfer clearable placeholder=\"选择性别\" />\r\n                </FormItem>\r\n                </Col>\r\n            </Row>\r\n            <Row :gutter=\"16\">\r\n                <Col span=\"12\">\r\n                <FormItem label=\"所属部门\" style=\"width:100%\">\r\n                    <department-tree-choose @on-change=\"handleSelectDepTree\" ref=\"depTree\"></department-tree-choose>\r\n                </FormItem>\r\n                </Col>\r\n                <Col span=\"12\">\r\n                <FormItem label=\"用户类型\" style=\"width:100%\">\r\n                    <Select v-model=\"form.type\" placeholder=\"请选择用户类型\">\r\n                        <Option :value=\"0\">普通用户</Option>\r\n                        <Option :value=\"1\">管理员</Option>\r\n                    </Select>\r\n                </FormItem>\r\n                </Col>\r\n            </Row>\r\n            <Row :gutter=\"16\">\r\n                <Col span=\"12\">\r\n                <FormItem label=\"头像\" style=\"width:100%\">\r\n                    <upload-pic-input v-model=\"form.avatar\"></upload-pic-input>\r\n                </FormItem>\r\n                </Col>\r\n                <Col span=\"12\">\r\n                <FormItem label=\"角色\" prop=\"roleIds\" style=\"width:100%\">\r\n                    <Select v-model=\"form.roleIds\" multiple>\r\n                        <Option v-for=\"item in roleList\" :value=\"item.id\" :key=\"item.id\" :label=\"item.name\">\r\n                            <span style=\"margin-right:10px;\">{{ item.name }}</span>\r\n                            <span style=\"color:#ccc;\">{{ item.description }}</span>\r\n                        </Option>\r\n                    </Select>\r\n                </FormItem>\r\n                </Col>\r\n            </Row>\r\n        </Form>\r\n    </Modal>\r\n</div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n    getAllRoleList,\r\n    addUser,\r\n    editUser\r\n} from \"./api.js\";\r\nimport {\r\n    validateUsername,\r\n    validateMobile,\r\n    validatePassword\r\n} from \"@/libs/validate\";\r\nimport departmentTreeChoose from \"@/views/template/department-tree-choose\";\r\nimport uploadPicInput from \"@/views/template/upload-pic-input\";\r\nimport SetPassword from \"@/views/template/set-password\";\r\nimport dict from \"@/views/template/dict\";\r\nexport default {\r\n    name: \"user\",\r\n    components: {\r\n        departmentTreeChoose,\r\n        uploadPicInput,\r\n        SetPassword,\r\n        dict\r\n    },\r\n    props: {\r\n        value: {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n        data: {\r\n            type: Object\r\n        },\r\n        type: {\r\n            type: String,\r\n            default: \"0\"\r\n        }\r\n    },\r\n    data() {\r\n        return {\r\n            visible: this.value,\r\n            title: \"\",\r\n            passColor: \"\",\r\n            submitLoading: false,\r\n            form: {\r\n                addressArray: []\r\n            },\r\n            formValidate: {\r\n                username: [{\r\n                        required: true,\r\n                        message: \"请输入登录账号\",\r\n                        trigger: \"blur\"\r\n                    },\r\n                    {\r\n                        validator: validateUsername,\r\n                        trigger: \"blur\"\r\n                    }\r\n                ],\r\n                nickname: [{\r\n                    required: true,\r\n                    message: \"请输入用户名\",\r\n                    trigger: \"blur\"\r\n                }],\r\n                mobile: [{\r\n                        required: true,\r\n                        message: \"请输入手机号\",\r\n                        trigger: \"blur\"\r\n                    },\r\n                    {\r\n                        validator: validateMobile,\r\n                        trigger: \"blur\"\r\n                    }\r\n                ],\r\n                password: [{\r\n                        required: true,\r\n                        message: \"请输入密码\",\r\n                        trigger: \"blur\"\r\n                    },\r\n                    {\r\n                        validator: validatePassword,\r\n                        trigger: \"blur\"\r\n                    }\r\n                ],\r\n                email: [{\r\n                        required: true,\r\n                        message: \"请输入邮箱地址\"\r\n                    },\r\n                    {\r\n                        type: \"email\",\r\n                        message: \"邮箱格式不正确\"\r\n                    }\r\n                ]\r\n            },\r\n            roleList: []\r\n        };\r\n    },\r\n    methods: {\r\n        init() {\r\n            this.getRoleList();\r\n        },\r\n        getRoleList() {\r\n            getAllRoleList().then(res => {\r\n                if (res.success) {\r\n                    this.roleList = res.result;\r\n                }\r\n            });\r\n        },\r\n        handleSelectDepTree(v) {\r\n            this.form.departmentId = v;\r\n        },\r\n        changeAddress(v) {\r\n            this.form.address = JSON.stringify(this.form.addressArray);\r\n        },\r\n        changePass(v, grade, strength) {\r\n            this.form.passStrength = strength;\r\n        },\r\n        submit() {\r\n            this.$refs.form.validate(valid => {\r\n                if (valid) {\r\n                    if (this.type == \"1\") {\r\n                        this.submitLoading = true;\r\n                        editUser(this.form).then(res => {\r\n                            this.submitLoading = false;\r\n                            if (res.success) {\r\n                                this.$Message.success(\"操作成功\");\r\n                                this.$emit(\"on-submit\", true);\r\n                                this.visible = false;\r\n                            }\r\n                        });\r\n                    } else {\r\n                        this.submitLoading = true;\r\n                        addUser(this.form).then(res => {\r\n                            this.submitLoading = false;\r\n                            if (res.success) {\r\n                                this.$Message.success(\"操作成功\");\r\n                                this.$emit(\"on-submit\", true);\r\n                                this.visible = false;\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        },\r\n        setCurrentValue(value) {\r\n            if (value === this.visible) {\r\n                return;\r\n            }\r\n            if (this.type == \"1\") {\r\n                this.title = \"编辑\";\r\n            } else if (this.type == \"2\") {\r\n                this.title = \"添加\";\r\n            } else {\r\n                this.title = \"详情\";\r\n            }\r\n            this.$refs.form.resetFields();\r\n            if (this.type == \"0\" || this.type == \"1\") {\r\n                // 回显数据\r\n                let data = this.data;\r\n                // 地址\r\n                if (data.address) {\r\n                    data.addressArray = JSON.parse(data.address);\r\n                } else {\r\n                    data.addressArray = [];\r\n                }\r\n                // 部门\r\n                this.$refs.depTree.setData(data.departmentId, data.departmentTitle);\r\n                // 角色\r\n                let selectRolesId = [];\r\n                data.roles.forEach(function (e) {\r\n                    selectRolesId.push(e.id);\r\n                });\r\n                data.roleIds = selectRolesId;\r\n                delete data.roles;\r\n                delete data.permissions;\r\n                // 密码强度\r\n                if (data.passStrength == \"弱\") {\r\n                    this.passColor = \"#ed3f14\";\r\n                } else if (data.passStrength == \"中\") {\r\n                    this.passColor = \"#faad14\";\r\n                } else if (data.passStrength == \"强\") {\r\n                    this.passColor = \"#52c41a\";\r\n                }\r\n                // 回显\r\n                this.form = data;\r\n            } else {\r\n                // 添加\r\n                this.$refs.depTree.setData(\"\", \"\");\r\n                this.form = {\r\n                    type: 0,\r\n                    sex: \"\",\r\n                    addressArray: []\r\n                };\r\n            }\r\n            this.visible = value;\r\n        }\r\n    },\r\n    watch: {\r\n        value(val) {\r\n            this.setCurrentValue(val);\r\n        },\r\n        visible(value) {\r\n            this.$emit(\"input\", value);\r\n        }\r\n    },\r\n    mounted() {\r\n        this.init();\r\n    }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\">\r\n\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}