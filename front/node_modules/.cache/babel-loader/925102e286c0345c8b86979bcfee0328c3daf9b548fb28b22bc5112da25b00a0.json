{"ast":null,"code":"import { getMyDoorList, setMyDoorList, userInfoEdit } from \"./api.js\";\nimport uploadPicThumb from \"@/views/template/upload-pic-thumb\";\nimport Cookies from \"js-cookie\";\nimport dict from \"@/views/template/dict\";\nimport search from \"./search.vue\";\nexport default {\n  components: {\n    uploadPicThumb,\n    dict,\n    search\n  },\n  name: \"my_home_index\",\n  data() {\n    return {\n      editFlag: false,\n      userForm: {\n        id: \"\",\n        avatar: \"\",\n        username: \"\",\n        sex: \"\",\n        status: \"\",\n        type: \"\",\n        typeTxt: \"\",\n        address: \"\",\n        addressArray: []\n      },\n      saveLoading: false,\n      addMenuTempList: []\n    };\n  },\n  methods: {\n    init() {\n      let v = JSON.parse(Cookies.get(\"userInfo\"));\n      for (let attr in v) {\n        if (v[attr] == null) {\n          v[attr] = \"\";\n        }\n      }\n      let str = JSON.stringify(v);\n      let userInfo = JSON.parse(str);\n      userInfo.addressArray = [];\n      this.userForm = userInfo;\n      if (userInfo.address) {\n        this.userForm.address = userInfo.address;\n        this.userForm.addressArray = JSON.parse(userInfo.address);\n      }\n      if (this.userForm.type == 0) {\n        this.userForm.typeTxt = \"普通用户\";\n      } else if (this.userForm.type == 1) {\n        this.userForm.typeTxt = \"管理员\";\n      }\n    },\n    addMenuTempFx(e) {\n      if (this.addMenuTempList.length > 5) {\n        this.$Message.warning(\"最多添加六个常用模块\");\n      } else {\n        this.addMenuTempList.push(e);\n      }\n    },\n    addMenuFx() {\n      var str = \"\";\n      var size = this.addMenuTempList.length;\n      if (size > 0) {\n        str += this.addMenuTempList[0].name;\n        for (var i = 1; i < size; i++) {\n          str += \"ZWZ666\" + this.addMenuTempList[i].name;\n        }\n      }\n      setMyDoorList({\n        str: str\n      }).then(res => {\n        if (res.success) {\n          this.$Message.warning(\"操作成功\");\n        }\n      });\n    },\n    saveEdit() {\n      this.saveLoading = true;\n      this.editFlag = false;\n      if (typeof this.userForm.birth == \"object\") {\n        this.userForm.birth = this.format(this.userForm.birth, \"yyyy-MM-dd\");\n      }\n      delete this.userForm.roles;\n      userInfoEdit(this.userForm).then(res => {\n        this.saveLoading = false;\n        if (res.success) {\n          this.$Message.success(\"保存成功\");\n          // 更新用户信息\n          Cookies.set(\"userInfo\", JSON.stringify(this.userForm));\n          // 更新头像\n          this.$store.commit(\"setAvatarPath\", this.userForm.avatar);\n        }\n      });\n    },\n    getMyDoorListFx() {\n      var that = this;\n      getMyDoorList().then(res => {\n        that.addMenuTempList = res.result;\n      });\n    },\n    deleteOneMenu(e) {\n      var array = [];\n      for (var i = 0; i < this.addMenuTempList.length; i++) {\n        if (this.addMenuTempList[i].name != e.name) {\n          array.push(this.addMenuTempList[i]);\n        }\n      }\n      this.addMenuTempList = array;\n    },\n    changeAddress() {\n      this.userForm.address = JSON.stringify(this.userForm.addressArray);\n    },\n    changeBirth(v) {\n      this.userForm.birth = v;\n    }\n  },\n  mounted() {\n    this.init();\n  }\n};","map":{"version":3,"names":["getMyDoorList","setMyDoorList","userInfoEdit","uploadPicThumb","Cookies","dict","search","components","name","data","editFlag","userForm","id","avatar","username","sex","status","type","typeTxt","address","addressArray","saveLoading","addMenuTempList","methods","init","v","JSON","parse","get","attr","str","stringify","userInfo","addMenuTempFx","e","length","$Message","warning","push","addMenuFx","size","i","then","res","success","saveEdit","birth","format","roles","set","$store","commit","getMyDoorListFx","that","result","deleteOneMenu","array","changeAddress","changeBirth","mounted"],"sources":["src/views/home/myHome.vue"],"sourcesContent":["<template>\r\n<div class=\"own-space\">\r\n    <Card>\r\n        <Divider dashed>\r\n            个人门户\r\n            <Button type=\"success\" v-show=\"!editFlag\" @click=\"editFlag = true\">开始编辑</Button>\r\n            <Button type=\"warning\" v-show=\"editFlag\" @click=\"saveEdit\">保存提交</Button>\r\n        </Divider>\r\n        <Form ref=\"userForm\" :model=\"userForm\" :label-width=\"90\" label-position=\"left\">\r\n            <Row :gutter=\"16\">\r\n                <Col :span=\"12\">\r\n                <FormItem label=\"登录账号\" prop=\"username\">\r\n                    <Input v-model=\"userForm.username\" readonly style=\"width: 100%\" />\r\n                </FormItem>\r\n                </Col>\r\n                <Col :span=\"12\">\r\n                <FormItem label=\"姓名\" prop=\"nickname\">\r\n                    <Input v-model=\"userForm.nickname\" readonly style=\"width: 100%\" />\r\n                </FormItem>\r\n                </Col>\r\n            </Row>\r\n            <Row :gutter=\"16\">\r\n                <Col :span=\"12\">\r\n                <FormItem label=\"账号类型\" prop=\"typeTxt\">\r\n                    <Input v-model=\"userForm.typeTxt\" readonly style=\"width: 100%\" />\r\n                </FormItem>\r\n                </Col>\r\n                <Col :span=\"12\">\r\n                <FormItem label=\"所属部门\" prop=\"departmentTitle\">\r\n                    <Input v-model=\"userForm.departmentTitle\" readonly style=\"width: 100%\" />\r\n                </FormItem>\r\n                </Col>\r\n            </Row>\r\n            <Row :gutter=\"16\">\r\n                <Col :span=\"12\">\r\n                <FormItem label=\"性别\" prop=\"username\">\r\n                    <dict dict=\"sex\" v-model=\"userForm.sex\" transfer :readonly=\"!editFlag\" placeholder=\"请选择性别\" style=\"width: 100%\" />\r\n                </FormItem>\r\n                </Col>\r\n                <Col :span=\"12\">\r\n                <FormItem label=\"头像\" prop=\"avatar\">\r\n                    <upload-pic-thumb v-model=\"userForm.avatar\" :multiple=\"false\" style=\"width: 100%\"></upload-pic-thumb>\r\n                </FormItem>\r\n                </Col>\r\n            </Row>\r\n            <Row :gutter=\"16\">\r\n                <Col :span=\"12\">\r\n                <FormItem label=\"家庭地址\" prop=\"nickname\">\r\n                    <Input v-model=\"userForm.street\" :readonly=\"!editFlag\" style=\"width: 100%\" />\r\n                </FormItem>\r\n                </Col>\r\n                <Col :span=\"12\">\r\n                <FormItem label=\"生日\" prop=\"username\">\r\n                    <DatePicker v-model=\"userForm.birth\" @on-change=\"changeBirth\" :readonly=\"!editFlag\" style=\"width: 100%\" type=\"date\"></DatePicker>\r\n                </FormItem>\r\n                </Col>\r\n            </Row>\r\n            <Row :gutter=\"16\">\r\n                <Col :span=\"24\">\r\n                <FormItem label=\"个性签名\" prop=\"nickname\">\r\n                    <Input v-model=\"userForm.description\" type=\"textarea\" :readonly=\"!editFlag\" style=\"width: 100%\" :autosize=\"{minRows: 3,maxRows: 5}\" placeholder=\"个性签名\"></Input>\r\n                </FormItem>\r\n                </Col>\r\n            </Row>\r\n        </Form>\r\n    </Card>\r\n    <Divider>个人门户</Divider>\r\n    <Card>\r\n        <Row :gutter=\"16\">\r\n            <Col span=\"12\">\r\n            <Divider>当前常用模块</Divider>\r\n            <List header=\"---\" footer=\"---\" border>\r\n                <ListItem v-for=\"(item, index) in addMenuTempList\" :key=\"index\">\r\n                    {{ item.title }}\r\n                    <Button @click=\"deleteOneMenu(item)\" type=\"error\" shape=\"circle\" icon=\"md-trash\" size=\"small\" style=\"marginLeft:20px;\"></Button>\r\n                </ListItem>\r\n            </List>\r\n            </Col>\r\n            <Col span=\"12\">\r\n            <Divider>个人门户设置\r\n                <Button @click=\"addMenuFx\" type=\"primary\">保存更改</Button></Divider>\r\n            <Row :gutter=\"16\">\r\n                <div class=\"desc\">在下面的完成选择菜单即可添加</div>\r\n                <search theme=\"light\" type=\"input\" @changeOk=\"addMenuTempFx\" />\r\n            </Row>\r\n            </Col>\r\n        </Row>\r\n    </Card>\r\n</div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n    getMyDoorList,\r\n    setMyDoorList,\r\n    userInfoEdit\r\n} from \"./api.js\";\r\nimport uploadPicThumb from \"@/views/template/upload-pic-thumb\";\r\nimport Cookies from \"js-cookie\";\r\nimport dict from \"@/views/template/dict\";\r\nimport search from \"./search.vue\";\r\nexport default {\r\n    components: {\r\n        uploadPicThumb,\r\n        dict,\r\n        search\r\n    },\r\n    name: \"my_home_index\",\r\n    data() {\r\n        return {\r\n            editFlag: false,\r\n            userForm: {\r\n                id: \"\",\r\n                avatar: \"\",\r\n                username: \"\",\r\n                sex: \"\",\r\n                status: \"\",\r\n                type: \"\",\r\n                typeTxt: \"\",\r\n                address: \"\",\r\n                addressArray: []\r\n            },\r\n            saveLoading: false,\r\n            addMenuTempList: []\r\n        };\r\n    },\r\n    methods: {\r\n        init() {\r\n            let v = JSON.parse(Cookies.get(\"userInfo\"));\r\n            for (let attr in v) {\r\n                if (v[attr] == null) {\r\n                    v[attr] = \"\";\r\n                }\r\n            }\r\n            let str = JSON.stringify(v);\r\n            let userInfo = JSON.parse(str);\r\n            userInfo.addressArray = [];\r\n            this.userForm = userInfo;\r\n            if (userInfo.address) {\r\n                this.userForm.address = userInfo.address;\r\n                this.userForm.addressArray = JSON.parse(userInfo.address);\r\n            }\r\n            if (this.userForm.type == 0) {\r\n                this.userForm.typeTxt = \"普通用户\";\r\n            } else if (this.userForm.type == 1) {\r\n                this.userForm.typeTxt = \"管理员\";\r\n            }\r\n        },\r\n        addMenuTempFx(e) {\r\n            if (this.addMenuTempList.length > 5) {\r\n                this.$Message.warning(\"最多添加六个常用模块\");\r\n            } else {\r\n                this.addMenuTempList.push(e);\r\n            }\r\n        },\r\n\r\n        addMenuFx() {\r\n            var str = \"\";\r\n            var size = this.addMenuTempList.length;\r\n            if (size > 0) {\r\n                str += this.addMenuTempList[0].name;\r\n                for (var i = 1; i < size; i++) {\r\n                    str += \"ZWZ666\" + this.addMenuTempList[i].name;\r\n                }\r\n            }\r\n            setMyDoorList({\r\n                str: str\r\n            }).then((res) => {\r\n                if (res.success) {\r\n                    this.$Message.warning(\"操作成功\");\r\n                }\r\n            });\r\n        },\r\n        saveEdit() {\r\n            this.saveLoading = true;\r\n            this.editFlag = false;\r\n            if (typeof this.userForm.birth == \"object\") {\r\n                this.userForm.birth = this.format(this.userForm.birth, \"yyyy-MM-dd\");\r\n            }\r\n            delete this.userForm.roles;\r\n            userInfoEdit(this.userForm).then(res => {\r\n                this.saveLoading = false;\r\n                if (res.success) {\r\n                    this.$Message.success(\"保存成功\");\r\n                    // 更新用户信息\r\n                    Cookies.set(\"userInfo\", JSON.stringify(this.userForm));\r\n                    // 更新头像\r\n                    this.$store.commit(\"setAvatarPath\", this.userForm.avatar);\r\n                }\r\n            });\r\n        },\r\n\r\n        getMyDoorListFx() {\r\n            var that = this;\r\n            getMyDoorList().then((res) => {\r\n                that.addMenuTempList = res.result;\r\n            });\r\n        },\r\n        deleteOneMenu(e) {\r\n            var array = [];\r\n            for (var i = 0; i < this.addMenuTempList.length; i++) {\r\n                if (this.addMenuTempList[i].name != e.name) {\r\n                    array.push(this.addMenuTempList[i]);\r\n                }\r\n            }\r\n            this.addMenuTempList = array;\r\n        },\r\n        changeAddress() {\r\n            this.userForm.address = JSON.stringify(this.userForm.addressArray);\r\n        },\r\n        changeBirth(v) {\r\n            this.userForm.birth = v;\r\n        }\r\n    },\r\n    mounted() {\r\n        this.init();\r\n    }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}