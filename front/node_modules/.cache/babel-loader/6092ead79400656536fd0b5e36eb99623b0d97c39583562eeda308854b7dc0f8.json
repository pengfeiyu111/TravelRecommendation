{"ast":null,"code":"import { addPermission, editPermission, deletePermission, searchPermission, getDictDataByType, getUserByPermission } from \"./api.js\";\nimport IconChoose from \"@/views/template/icon-choose\";\nimport util from \"@/libs/util.js\";\nexport default {\n  name: \"menu\",\n  components: {\n    IconChoose\n  },\n  data() {\n    return {\n      userByPermissionLoading: false,\n      loading: true,\n      strict: true,\n      maxHeight: 500,\n      menuModalVisible: false,\n      iconModalVisible: false,\n      selectList: [],\n      selectCount: 0,\n      showParent: false,\n      searchKey: \"\",\n      parentTitle: \"\",\n      editTitle: \"\",\n      modalTitle: \"\",\n      form: {\n        id: \"\",\n        title: \"\",\n        name: \"\",\n        icon: \"\",\n        path: \"\",\n        component: \"\",\n        parentId: \"\",\n        buttonType: \"\",\n        type: 0,\n        sortOrder: 0,\n        level: 0,\n        status: 0,\n        url: \"\"\n      },\n      formAdd: {\n        buttonType: \"\"\n      },\n      formValidate: {\n        title: [{\n          required: true,\n          message: \"菜单名称不能为空\",\n          trigger: \"blur\"\n        }],\n        name: [{\n          required: true,\n          message: \"路由英文名不能为空\",\n          trigger: \"blur\"\n        }],\n        icon: [{\n          required: true,\n          message: \"图标不能为空\",\n          trigger: \"click\"\n        }],\n        path: [{\n          required: true,\n          message: \"路径不能为空\",\n          trigger: \"blur\"\n        }],\n        component: [{\n          required: true,\n          message: \"对应位置不能为空\",\n          trigger: \"blur\"\n        }],\n        sortOrder: [{\n          required: true,\n          type: \"number\",\n          message: \"排序值不能为空\",\n          trigger: \"blur\"\n        }]\n      },\n      submitLoading: false,\n      data: [],\n      dictPermissions: [],\n      userByPermissionList: [],\n      userByPermissionColumns: [{\n        title: \"用户名\",\n        key: \"userName\",\n        minWidth: 120,\n        tooltip: true,\n        sortable: false\n      }, {\n        title: \"对应角色\",\n        key: \"roleStr\",\n        minWidth: 200,\n        tooltip: true,\n        sortable: false\n      }, {\n        title: \"登录账号\",\n        key: \"code\",\n        minWidth: 120,\n        tooltip: true,\n        sortable: false\n      }, {\n        title: \"用户手机\",\n        key: \"mobile\",\n        minWidth: 120,\n        tooltip: true,\n        sortable: false\n      }, {\n        title: \"用户标识\",\n        key: \"userId\",\n        minWidth: 120,\n        tooltip: true,\n        sortable: false\n      }]\n    };\n  },\n  methods: {\n    init() {\n      this.getPermissionList();\n      this.getDictPermissions();\n    },\n    changeFormPath() {\n      this.form.name = this.form.path;\n    },\n    changeFormName() {\n      this.form.path = this.form.name;\n    },\n    getDictPermissions() {\n      getDictDataByType(\"permission_type\").then(res => {\n        if (res.success) {\n          this.dictPermissions = res.result;\n        }\n      });\n    },\n    renderContent(h, {\n      root,\n      node,\n      data\n    }) {\n      let icon = \"\";\n      if (data.level == 0) {\n        icon = \"ios-navigate\";\n      } else if (data.level == 1) {\n        icon = \"md-list-box\";\n      } else if (data.level == 2) {\n        icon = \"md-list\";\n      } else if (data.level == 3) {\n        icon = \"md-radio-button-on\";\n      } else {\n        icon = \"md-radio-button-off\";\n      }\n      return h(\"span\", [h(\"span\", [h(\"Icon\", {\n        props: {\n          type: icon,\n          size: \"16\"\n        },\n        style: {\n          \"margin-right\": \"8px\",\n          \"margin-bottom\": \"3px\"\n        }\n      }), h(\"span\", data.title)])]);\n    },\n    getPermissionList() {\n      this.loading = true;\n      this.getRequest(\"/permission/getAllList\").then(res => {\n        this.loading = false;\n        if (res.success) {\n          this.data = res.result;\n        }\n      });\n    },\n    search() {\n      if (this.searchKey) {\n        this.loading = true;\n        searchPermission({\n          title: this.searchKey\n        }).then(res => {\n          this.loading = false;\n          if (res.success) {\n            this.data = res.result;\n          }\n        });\n      } else {\n        this.getPermissionList();\n      }\n    },\n    selectTree(v) {\n      if (v.length > 0) {\n        // 转换null为\"\"\n        for (let attr in v[0]) {\n          if (v[0][attr] == null) {\n            v[0][attr] = \"\";\n          }\n        }\n        let str = JSON.stringify(v[0]);\n        let menu = JSON.parse(str);\n        this.form = menu;\n        this.editTitle = menu.title;\n        this.getUserByPermission();\n      } else {\n        this.cancelEdit();\n        this.userByPermissionList = [];\n      }\n    },\n    getUserByPermission() {\n      var that = this;\n      that.userByPermissionLoading = true;\n      getUserByPermission({\n        permissionId: that.form.id\n      }).then(res => {\n        that.userByPermissionLoading = false;\n        if (res.success) {\n          that.userByPermissionList = res.result;\n        }\n      });\n    },\n    cancelEdit() {\n      let data = this.$refs.tree.getSelectedNodes()[0];\n      if (data) {\n        data.selected = false;\n      }\n      this.$refs.form.resetFields();\n      this.form.id = \"\";\n      this.editTitle = \"\";\n    },\n    handleReset() {\n      let type = this.form.type;\n      this.$refs.form.resetFields();\n      this.form.icon = \"\";\n      this.form.component = \"\";\n      this.form.type = type;\n    },\n    submitEdit() {\n      if (!this.form.id) {\n        this.$Message.warning(\"请先点击选择要修改的菜单节点\");\n        return;\n      }\n      this.submitLoading = true;\n      if (this.form.sortOrder == null) {\n        this.form.sortOrder = \"\";\n      }\n      if (this.form.buttonType == null) {\n        this.form.buttonType = \"\";\n      }\n      if (this.form.type == 1) {\n        this.form.name = \"\";\n        this.form.icon = \"\";\n        this.form.component = \"\";\n      }\n      delete this.form.updateTime;\n      delete this.form.children;\n      editPermission(this.form).then(res => {\n        this.submitLoading = false;\n        if (res.success) {\n          this.$Message.success(\"编辑成功\");\n          // 标记重新获取菜单数据\n          this.$store.commit(\"setAdded\", false);\n          util.initRouter(this);\n          this.init();\n          this.menuModalVisible = false;\n        }\n      });\n    },\n    submitAdd() {\n      this.$refs.formAdd.validate(valid => {\n        if (valid) {\n          this.submitLoading = true;\n          if (this.formAdd.type == 1) {\n            this.formAdd.name = \"\";\n            this.formAdd.icon = \"\";\n            this.formAdd.component = \"\";\n          }\n          addPermission(this.formAdd).then(res => {\n            this.submitLoading = false;\n            if (res.success) {\n              this.$Message.success(\"添加成功\");\n              this.$store.commit(\"setAdded\", false);\n              util.initRouter(this);\n              this.init();\n              this.menuModalVisible = false;\n            }\n          });\n        }\n      });\n    },\n    addMenu() {\n      if (!this.form.id) {\n        this.modalTitle = \"添加顶部菜单(可拖动)\";\n        this.showParent = false;\n        this.formAdd = {\n          type: -1,\n          level: 0,\n          sortOrder: 0,\n          status: 0\n        };\n        this.menuModalVisible = true;\n        return;\n      }\n      this.parentTitle = this.form.title;\n      this.modalTitle = \"添加子节点\";\n      this.showParent = true;\n      let type = 0;\n      if (this.form.level == 1) {\n        type = 0;\n      } else if (this.form.level == 2) {\n        type = 1;\n      } else if (this.form.level == 3) {\n        this.$Modal.warning({\n          title: \"抱歉，不能添加啦\",\n          content: \"仅支持2级菜单目录\"\n        });\n        return;\n      } else {\n        type = 0;\n      }\n      let component = \"\";\n      this.formAdd = {\n        icon: \"\",\n        type: type,\n        parentId: this.form.id,\n        level: Number(this.form.level) + 1,\n        sortOrder: 0,\n        buttonType: \"\",\n        status: 0\n      };\n      if (this.form.level == 0) {\n        this.formAdd.path = \"/\";\n        this.formAdd.component = \"Main\";\n      } else if (this.form.level == 2) {\n        this.formAdd.path = \"无\";\n      }\n      this.menuModalVisible = true;\n    },\n    changeSelect(v) {\n      this.selectCount = v.length;\n      this.selectList = v;\n    },\n    deletePermissionFx() {\n      if (this.selectCount <= 0) {\n        this.$Message.warning(\"请选择要删除的菜单\");\n        return;\n      }\n      this.$Modal.confirm({\n        title: \"确认删除\",\n        content: \"您确认要删除所选的 \" + this.selectCount + \" 条数据?\",\n        loading: true,\n        onOk: () => {\n          let ids = \"\";\n          this.selectList.forEach(function (e) {\n            ids += e.id + \",\";\n          });\n          ids = ids.substring(0, ids.length - 1);\n          deletePermission({\n            ids: ids\n          }).then(res => {\n            this.$Modal.remove();\n            if (res.success) {\n              this.$Message.success(\"删除成功\");\n              this.$store.commit(\"setAdded\", false);\n              util.initRouter(this);\n              this.selectList = [];\n              this.selectCount = 0;\n              this.cancelEdit();\n              this.init();\n            }\n          });\n        }\n      });\n    }\n  },\n  mounted() {\n    let height = document.documentElement.clientHeight;\n    this.maxHeight = Number(height - 260);\n    this.init();\n  }\n};","map":{"version":3,"names":["addPermission","editPermission","deletePermission","searchPermission","getDictDataByType","getUserByPermission","IconChoose","util","name","components","data","userByPermissionLoading","loading","strict","maxHeight","menuModalVisible","iconModalVisible","selectList","selectCount","showParent","searchKey","parentTitle","editTitle","modalTitle","form","id","title","icon","path","component","parentId","buttonType","type","sortOrder","level","status","url","formAdd","formValidate","required","message","trigger","submitLoading","dictPermissions","userByPermissionList","userByPermissionColumns","key","minWidth","tooltip","sortable","methods","init","getPermissionList","getDictPermissions","changeFormPath","changeFormName","then","res","success","result","renderContent","h","root","node","props","size","style","getRequest","search","selectTree","v","length","attr","str","JSON","stringify","menu","parse","cancelEdit","that","permissionId","$refs","tree","getSelectedNodes","selected","resetFields","handleReset","submitEdit","$Message","warning","updateTime","children","$store","commit","initRouter","submitAdd","validate","valid","addMenu","$Modal","content","Number","changeSelect","deletePermissionFx","confirm","onOk","ids","forEach","e","substring","remove","mounted","height","document","documentElement","clientHeight"],"sources":["src/views/menu/menu/index.vue"],"sourcesContent":["<template>\r\n<div class=\"search\">\r\n    <Card>\r\n        <Row :gutter=\"16\">\r\n            <Col span=\"7\">\r\n            <Row :gutter=\"16\">\r\n                <Col span=\"23\">\r\n                <div class=\"tree-bar\" style=\"overflow-y: scroll;padding-right: 50px;\" :style=\"{maxHeight: maxHeight + 'px'}\">\r\n                    <Tree ref=\"tree\" :data=\"data\" show-checkbox :render=\"renderContent\" @on-select-change=\"selectTree\" @on-check-change=\"changeSelect\" :check-strictly=\"!strict\"></Tree>\r\n                    <Spin size=\"large\" fix v-if=\"loading\"></Spin>\r\n                </div>\r\n                </Col>\r\n            </Row>\r\n            </Col>\r\n            <Col span=\"15\">\r\n            <Row class=\"operation\">\r\n                <Col span=\"12\">\r\n                <Button @click=\"addMenu\" type=\"primary\" shape=\"circle\" ghost icon=\"md-add\" :disabled=\"!$route.meta.permTypes.includes('add')\">添加菜单</Button>\r\n                <Button @click=\"deletePermissionFx\" type=\"error\" shape=\"circle\" ghost icon=\"md-trash\" :disabled=\"!$route.meta.permTypes.includes('delete')\">删除菜单</Button>\r\n                <Button @click=\"getPermissionList\" type=\"success\" shape=\"circle\" ghost icon=\"md-trash\">刷新菜单</Button>\r\n                <i-switch v-model=\"strict\" size=\"large\" style=\"margin-left:5px\">\r\n                    <span slot=\"open\">级联</span>\r\n                    <span slot=\"close\">单选</span>\r\n                </i-switch>\r\n                </Col>\r\n                <Col span=\"12\">\r\n                <Input v-model=\"searchKey\" suffix=\"ios-search\" @on-change=\"search\" placeholder=\"模拟搜索菜单\" clearable />\r\n                </Col>\r\n            </Row>\r\n            <Divider dashed />\r\n            <Row :gutter=\"16\" v-show=\"form.id\">\r\n                <Col span=\"24\">\r\n                <Alert show-icon type=\"success\">\r\n                    当前选择的菜单：\r\n                    <span class=\"select-title\">{{editTitle}}</span>\r\n                    <Divider type=\"vertical\" />\r\n                    <a class=\"select-clear\" @click=\"cancelEdit\">取消选择</a>\r\n                </Alert>\r\n                </Col>\r\n                <Divider dashed />\r\n            </Row>\r\n            <Form ref=\"form\" :model=\"form\" :label-width=\"130\" :rules=\"formValidate\">\r\n                <Row :gutter=\"16\">\r\n                    <Col span=\"12\">\r\n                    <FormItem label=\"类型\" prop=\"type\">\r\n                        <div v-show=\"form.type==-1\">\r\n                            <Icon type=\"ios-navigate-outline\" size=\"16\" style=\"margin-right:5px;\"></Icon>\r\n                            <span>一级菜单</span>\r\n                        </div>\r\n                        <div v-show=\"form.type==0\">\r\n                            <Icon type=\"ios-list-box-outline\" size=\"16\" style=\"margin-right:5px;\"></Icon>\r\n                            <span>普通菜单</span>\r\n                        </div>\r\n                        <div v-show=\"form.type==1\">\r\n                            <Icon type=\"md-radio-button-on\" size=\"16\" style=\"margin-right:5px;\"></Icon>\r\n                            <span>按钮级权限</span>\r\n                        </div>\r\n                    </FormItem>\r\n                    </Col>\r\n                    <Col span=\"12\" v-show=\"form.type==-1||form.type==0\">\r\n                    <FormItem label=\"名称\" prop=\"title\">\r\n                        <Input v-model=\"form.title\" style=\"width:100%\" />\r\n                    </FormItem>\r\n                    </Col>\r\n                    <Col span=\"12\" v-show=\"form.type==1\">\r\n                    <FormItem label=\"名称\" prop=\"title\">\r\n                        <Input v-model=\"form.title\" placeholder=\"操作按钮名称不得重复\" style=\"width:100%\" />\r\n                    </FormItem>\r\n                    </Col>\r\n                    <Col span=\"12\" v-show=\"form.type==0\">\r\n                    <FormItem label=\"路径\" prop=\"path\">\r\n                        <Input v-model=\"form.path\" @on-blur=\"changeFormPath\" style=\"width:100%\" />\r\n                    </FormItem>\r\n                    </Col>\r\n                    <Col span=\"12\" v-show=\"form.type==1\">\r\n                    <FormItem label=\"按钮权限类型\" prop=\"buttonType\">\r\n                        <Select v-model=\"form.buttonType\" placeholder=\"请选择或输入搜索\" filterable clearable style=\"width:100%\">\r\n                            <Option v-for=\"(item, i) in dictPermissions\" :key=\"i\" :value=\"item.value\">{{item.title}}</Option>\r\n                        </Select>\r\n                    </FormItem>\r\n                    </Col>\r\n                    <Col span=\"12\" v-show=\"form.type==-1\">\r\n                    <FormItem :label=\"form.type==-1? '英文名' : '路由英文名'\" prop=\"name\">\r\n                        <Input v-model=\"form.name\" @on-blur=\"changeFormName\" placeholder=\"需唯一\" style=\"width:100%\" />\r\n                    </FormItem>\r\n                    </Col>\r\n                    <Col span=\"12\" v-show=\"form.type==-1||form.type==0\">\r\n                    <FormItem label=\"图标\" prop=\"icon\">\r\n                        <icon-choose v-model=\"form.icon\"></icon-choose>\r\n                    </FormItem>\r\n                    </Col>\r\n                    <Col span=\"12\" v-show=\"form.type==0\">\r\n                    <FormItem label=\"对应位置\" prop=\"component\">\r\n                        <Input v-model=\"form.component\" style=\"width:100%\" />\r\n                    </FormItem>\r\n                    </Col>\r\n                    <Col span=\"12\">\r\n                    <FormItem label=\"排序值\" prop=\"sortOrder\">\r\n                        <InputNumber :max=\"1000\" :min=\"0\" v-model=\"form.sortOrder\" style=\"width:100%\"></InputNumber>\r\n                    </FormItem>\r\n                    </Col>\r\n                    <Col span=\"12\">\r\n                    <FormItem label=\"是否启用\" prop=\"status\">\r\n                        <i-switch size=\"large\" v-model=\"form.status\" :true-value=\"0\" :false-value=\"-1\">\r\n                            <span slot=\"open\">启用</span>\r\n                            <span slot=\"close\">禁用</span>\r\n                        </i-switch>\r\n                    </FormItem>\r\n                    </Col>\r\n                    <Col span=\"12\">\r\n                    <Form-item>\r\n                        <Button style=\"margin-right:5px\" @click=\"submitEdit\" ghost shape=\"circle\" :loading=\"submitLoading\" type=\"primary\" icon=\"ios-create-outline\" :disabled=\"!$route.meta.permTypes.includes('edit')\">保存菜单</Button>\r\n                    </Form-item>\r\n                    </Col>\r\n                </Row>\r\n            </Form>\r\n            <Divider>有 {{form.title}} 权限的用户</Divider>\r\n            <Row :gutter=\"16\">\r\n                <Table :loading=\"userByPermissionLoading\" border stripe size=\"small\" :columns=\"userByPermissionColumns\" :data=\"userByPermissionList\"></Table>\r\n            </Row>\r\n            </Col>\r\n        </Row>\r\n    </Card>\r\n\r\n    <Modal draggable :title=\"modalTitle\" v-model=\"menuModalVisible\" :mask=\"false\" :width=\"500\" :styles=\"{top: '30px'}\">\r\n        <Form ref=\"formAdd\" :model=\"formAdd\" :label-width=\"100\" :rules=\"formValidate\">\r\n            <div v-if=\"showParent\">\r\n                <FormItem label=\"上级节点：\">{{parentTitle}}</FormItem>\r\n            </div>\r\n            <FormItem label=\"类型\" prop=\"type\">\r\n                <div v-show=\"formAdd.type==-1\">\r\n                    <Icon type=\"ios-navigate-outline\" size=\"16\" style=\"margin-right:5px;\"></Icon>\r\n                    <span>顶部菜单</span>\r\n                </div>\r\n                <div v-show=\"formAdd.type==0\">\r\n                    <Icon type=\"ios-list-box-outline\" size=\"16\" style=\"margin-right:5px;\"></Icon>\r\n                    <span>页面菜单</span>\r\n                </div>\r\n                <div v-show=\"formAdd.type==1\">\r\n                    <Icon type=\"md-radio-button-on\" size=\"16\" style=\"margin-right:5px;\"></Icon>\r\n                    <span>操作按钮</span>\r\n                </div>\r\n            </FormItem>\r\n            <FormItem label=\"名称\" prop=\"title\" v-if=\"formAdd.type==-1||formAdd.type==0\">\r\n                <Input v-model=\"formAdd.title\" />\r\n            </FormItem>\r\n            <FormItem label=\"名称\" prop=\"title\" v-if=\"formAdd.type==1\" class=\"block-tool\">\r\n                <Tooltip placement=\"right\" content=\"操作按钮名称不得重复\">\r\n                    <Input v-model=\"formAdd.title\" />\r\n                </Tooltip>\r\n            </FormItem>\r\n            <FormItem label=\"路径\" prop=\"path\" v-if=\"formAdd.type==0\">\r\n                <Input v-model=\"formAdd.path\" />\r\n            </FormItem>\r\n            <FormItem label=\"按钮权限类型\" prop=\"buttonType\" v-if=\"formAdd.type==1\">\r\n                <Select v-model=\"formAdd.buttonType\" placeholder=\"请选择或输入搜索\" filterable clearable>\r\n                    <Option v-for=\"(item, i) in dictPermissions\" :key=\"i\" :value=\"item.value\">{{item.title}}</Option>\r\n                </Select>\r\n            </FormItem>\r\n            <FormItem label=\"英文名\" prop=\"name\" v-if=\"formAdd.type==-1\" class=\"block-tool\">\r\n                <Tooltip placement=\"right\" content=\"需唯一\">\r\n                    <Input v-model=\"formAdd.name\" />\r\n                </Tooltip>\r\n            </FormItem>\r\n            <FormItem label=\"路由英文名\" prop=\"name\" v-if=\"formAdd.type==0\" class=\"block-tool\">\r\n                <Tooltip placement=\"right\" content=\"需唯一\">\r\n                    <Input v-model=\"formAdd.name\" />\r\n                </Tooltip>\r\n            </FormItem>\r\n            <FormItem label=\"图标\" prop=\"icon\" v-if=\"formAdd.type==-1||formAdd.type==0\">\r\n                <icon-choose v-model=\"formAdd.icon\"></icon-choose>\r\n            </FormItem>\r\n            <FormItem label=\"对应位置\" prop=\"component\" v-if=\"formAdd.type==0\">\r\n                <Input v-model=\"formAdd.component\" />\r\n            </FormItem>\r\n            <FormItem label=\"排序值\" prop=\"sortOrder\">\r\n                <InputNumber :max=\"1000\" :min=\"0\" v-model=\"formAdd.sortOrder\"></InputNumber>\r\n            </FormItem>\r\n            <FormItem label=\"是否启用\" prop=\"status\">\r\n                <i-switch size=\"large\" v-model=\"formAdd.status\" :true-value=\"0\" :false-value=\"-1\">\r\n                    <span slot=\"open\">启用</span>\r\n                    <span slot=\"close\">禁用</span>\r\n                </i-switch>\r\n            </FormItem>\r\n        </Form>\r\n        <div slot=\"footer\">\r\n            <Button type=\"text\" @click=\"menuModalVisible = false\">取消</Button>\r\n            <Button type=\"primary\" :loading=\"submitLoading\" @click=\"submitAdd\">提交</Button>\r\n        </div>\r\n    </Modal>\r\n</div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n    addPermission,\r\n    editPermission,\r\n    deletePermission,\r\n    searchPermission,\r\n    getDictDataByType,\r\n    getUserByPermission\r\n} from \"./api.js\";\r\nimport IconChoose from \"@/views/template/icon-choose\";\r\nimport util from \"@/libs/util.js\";\r\nexport default {\r\n    name: \"menu\",\r\n    components: {\r\n        IconChoose\r\n    },\r\n    data() {\r\n        return {\r\n            userByPermissionLoading: false,\r\n            loading: true,\r\n            strict: true,\r\n            maxHeight: 500,\r\n            menuModalVisible: false,\r\n            iconModalVisible: false,\r\n            selectList: [],\r\n            selectCount: 0,\r\n            showParent: false,\r\n            searchKey: \"\",\r\n            parentTitle: \"\",\r\n            editTitle: \"\",\r\n            modalTitle: \"\",\r\n            form: {\r\n                id: \"\",\r\n                title: \"\",\r\n                name: \"\",\r\n                icon: \"\",\r\n                path: \"\",\r\n                component: \"\",\r\n                parentId: \"\",\r\n                buttonType: \"\",\r\n                type: 0,\r\n                sortOrder: 0,\r\n                level: 0,\r\n                status: 0,\r\n                url: \"\"\r\n            },\r\n            formAdd: {\r\n                buttonType: \"\"\r\n            },\r\n            formValidate: {\r\n                title: [{\r\n                    required: true,\r\n                    message: \"菜单名称不能为空\",\r\n                    trigger: \"blur\"\r\n                }],\r\n                name: [{\r\n                    required: true,\r\n                    message: \"路由英文名不能为空\",\r\n                    trigger: \"blur\"\r\n                }],\r\n                icon: [{\r\n                    required: true,\r\n                    message: \"图标不能为空\",\r\n                    trigger: \"click\"\r\n                }],\r\n                path: [{\r\n                    required: true,\r\n                    message: \"路径不能为空\",\r\n                    trigger: \"blur\"\r\n                }],\r\n                component: [{\r\n                    required: true,\r\n                    message: \"对应位置不能为空\",\r\n                    trigger: \"blur\"\r\n                }],\r\n                sortOrder: [{\r\n                    required: true,\r\n                    type: \"number\",\r\n                    message: \"排序值不能为空\",\r\n                    trigger: \"blur\"\r\n                }]\r\n            },\r\n            submitLoading: false,\r\n            data: [],\r\n            dictPermissions: [],\r\n            userByPermissionList: [],\r\n            userByPermissionColumns: [{\r\n                title: \"用户名\",\r\n                key: \"userName\",\r\n                minWidth: 120,\r\n                tooltip: true,\r\n                sortable: false,\r\n            }, {\r\n                title: \"对应角色\",\r\n                key: \"roleStr\",\r\n                minWidth: 200,\r\n                tooltip: true,\r\n                sortable: false,\r\n            }, {\r\n                title: \"登录账号\",\r\n                key: \"code\",\r\n                minWidth: 120,\r\n                tooltip: true,\r\n                sortable: false,\r\n            }, {\r\n                title: \"用户手机\",\r\n                key: \"mobile\",\r\n                minWidth: 120,\r\n                tooltip: true,\r\n                sortable: false,\r\n            }, {\r\n                title: \"用户标识\",\r\n                key: \"userId\",\r\n                minWidth: 120,\r\n                tooltip: true,\r\n                sortable: false,\r\n            }]\r\n        };\r\n    },\r\n    methods: {\r\n        init() {\r\n            this.getPermissionList();\r\n            this.getDictPermissions();\r\n        },\r\n        changeFormPath() {\r\n            this.form.name = this.form.path;\r\n        },\r\n        changeFormName() {\r\n            this.form.path = this.form.name;\r\n        },\r\n        getDictPermissions() {\r\n            getDictDataByType(\"permission_type\").then(res => {\r\n                if (res.success) {\r\n                    this.dictPermissions = res.result;\r\n                }\r\n            });\r\n        },\r\n        renderContent(h, {\r\n            root,\r\n            node,\r\n            data\r\n        }) {\r\n            let icon = \"\";\r\n            if (data.level == 0) {\r\n                icon = \"ios-navigate\";\r\n            } else if (data.level == 1) {\r\n                icon = \"md-list-box\";\r\n            } else if (data.level == 2) {\r\n                icon = \"md-list\";\r\n            } else if (data.level == 3) {\r\n                icon = \"md-radio-button-on\";\r\n            } else {\r\n                icon = \"md-radio-button-off\";\r\n            }\r\n            return h(\"span\", [\r\n                h(\"span\", [\r\n                    h(\"Icon\", {\r\n                        props: {\r\n                            type: icon,\r\n                            size: \"16\"\r\n                        },\r\n                        style: {\r\n                            \"margin-right\": \"8px\",\r\n                            \"margin-bottom\": \"3px\"\r\n                        }\r\n                    }),\r\n                    h(\"span\", data.title)\r\n                ])\r\n            ]);\r\n        },\r\n        getPermissionList() {\r\n            this.loading = true;\r\n            this.getRequest(\"/permission/getAllList\").then(res => {\r\n                this.loading = false;\r\n                if (res.success) {\r\n                    this.data = res.result;\r\n                }\r\n            });\r\n        },\r\n        search() {\r\n            if (this.searchKey) {\r\n                this.loading = true;\r\n                searchPermission({\r\n                    title: this.searchKey\r\n                }).then(res => {\r\n                    this.loading = false;\r\n                    if (res.success) {\r\n                        this.data = res.result;\r\n                    }\r\n                });\r\n            } else {\r\n                this.getPermissionList();\r\n            }\r\n        },\r\n        selectTree(v) {\r\n            if (v.length > 0) {\r\n                // 转换null为\"\"\r\n                for (let attr in v[0]) {\r\n                    if (v[0][attr] == null) {\r\n                        v[0][attr] = \"\";\r\n                    }\r\n                }\r\n                let str = JSON.stringify(v[0]);\r\n                let menu = JSON.parse(str);\r\n                this.form = menu;\r\n                this.editTitle = menu.title;\r\n                this.getUserByPermission();\r\n            } else {\r\n                this.cancelEdit();\r\n                this.userByPermissionList = [];\r\n            }\r\n        },\r\n        getUserByPermission() {\r\n            var that = this;\r\n            that.userByPermissionLoading = true;\r\n            getUserByPermission({\r\n                permissionId: that.form.id\r\n            }).then(res => {\r\n                that.userByPermissionLoading = false;\r\n                if (res.success) {\r\n                    that.userByPermissionList = res.result;\r\n                }\r\n            })\r\n        },\r\n        cancelEdit() {\r\n            let data = this.$refs.tree.getSelectedNodes()[0];\r\n            if (data) {\r\n                data.selected = false;\r\n            }\r\n            this.$refs.form.resetFields();\r\n            this.form.id = \"\";\r\n            this.editTitle = \"\";\r\n        },\r\n        handleReset() {\r\n            let type = this.form.type;\r\n            this.$refs.form.resetFields();\r\n            this.form.icon = \"\";\r\n            this.form.component = \"\";\r\n            this.form.type = type;\r\n        },\r\n        submitEdit() {\r\n            if (!this.form.id) {\r\n                this.$Message.warning(\"请先点击选择要修改的菜单节点\");\r\n                return;\r\n            }\r\n            this.submitLoading = true;\r\n            if (this.form.sortOrder == null) {\r\n                this.form.sortOrder = \"\";\r\n            }\r\n            if (this.form.buttonType == null) {\r\n                this.form.buttonType = \"\";\r\n            }\r\n            if (this.form.type == 1) {\r\n                this.form.name = \"\";\r\n                this.form.icon = \"\";\r\n                this.form.component = \"\";\r\n            }\r\n            delete this.form.updateTime;\r\n            delete this.form.children;\r\n            editPermission(this.form).then(res => {\r\n                this.submitLoading = false;\r\n                if (res.success) {\r\n                    this.$Message.success(\"编辑成功\");\r\n                    // 标记重新获取菜单数据\r\n                    this.$store.commit(\"setAdded\", false);\r\n                    util.initRouter(this);\r\n                    this.init();\r\n                    this.menuModalVisible = false;\r\n                }\r\n            });\r\n        },\r\n        submitAdd() {\r\n            this.$refs.formAdd.validate(valid => {\r\n                if (valid) {\r\n                    this.submitLoading = true;\r\n                    if (this.formAdd.type == 1) {\r\n                        this.formAdd.name = \"\";\r\n                        this.formAdd.icon = \"\";\r\n                        this.formAdd.component = \"\";\r\n                    }\r\n                    addPermission(this.formAdd).then(res => {\r\n                        this.submitLoading = false;\r\n                        if (res.success) {\r\n                            this.$Message.success(\"添加成功\");\r\n                            this.$store.commit(\"setAdded\", false);\r\n                            util.initRouter(this);\r\n                            this.init();\r\n                            this.menuModalVisible = false;\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        },\r\n        addMenu() {\r\n            if (!this.form.id) {\r\n                this.modalTitle = \"添加顶部菜单(可拖动)\";\r\n                this.showParent = false;\r\n                this.formAdd = {\r\n                    type: -1,\r\n                    level: 0,\r\n                    sortOrder: 0,\r\n                    status: 0\r\n                };\r\n                this.menuModalVisible = true;\r\n                return;\r\n            }\r\n            this.parentTitle = this.form.title;\r\n            this.modalTitle = \"添加子节点\";\r\n            this.showParent = true;\r\n            let type = 0;\r\n            if (this.form.level == 1) {\r\n                type = 0;\r\n            } else if (this.form.level == 2) {\r\n                type = 1;\r\n            } else if (this.form.level == 3) {\r\n                this.$Modal.warning({\r\n                    title: \"抱歉，不能添加啦\",\r\n                    content: \"仅支持2级菜单目录\"\r\n                });\r\n                return;\r\n            } else {\r\n                type = 0;\r\n            }\r\n            let component = \"\";\r\n            this.formAdd = {\r\n                icon: \"\",\r\n                type: type,\r\n                parentId: this.form.id,\r\n                level: Number(this.form.level) + 1,\r\n                sortOrder: 0,\r\n                buttonType: \"\",\r\n                status: 0\r\n            };\r\n            if (this.form.level == 0) {\r\n                this.formAdd.path = \"/\";\r\n                this.formAdd.component = \"Main\";\r\n            } else if (this.form.level == 2) {\r\n                this.formAdd.path = \"无\";\r\n            }\r\n            this.menuModalVisible = true;\r\n        },\r\n        changeSelect(v) {\r\n            this.selectCount = v.length;\r\n            this.selectList = v;\r\n        },\r\n        deletePermissionFx() {\r\n            if (this.selectCount <= 0) {\r\n                this.$Message.warning(\"请选择要删除的菜单\");\r\n                return;\r\n            }\r\n            this.$Modal.confirm({\r\n                title: \"确认删除\",\r\n                content: \"您确认要删除所选的 \" + this.selectCount + \" 条数据?\",\r\n                loading: true,\r\n                onOk: () => {\r\n                    let ids = \"\";\r\n                    this.selectList.forEach(function (e) {\r\n                        ids += e.id + \",\";\r\n                    });\r\n                    ids = ids.substring(0, ids.length - 1);\r\n                    deletePermission({\r\n                        ids: ids\r\n                    }).then(res => {\r\n                        this.$Modal.remove();\r\n                        if (res.success) {\r\n                            this.$Message.success(\"删除成功\");\r\n                            this.$store.commit(\"setAdded\", false);\r\n                            util.initRouter(this);\r\n                            this.selectList = [];\r\n                            this.selectCount = 0;\r\n                            this.cancelEdit();\r\n                            this.init();\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    },\r\n    mounted() {\r\n        let height = document.documentElement.clientHeight;\r\n        this.maxHeight = Number(height - 260);\r\n        this.init();\r\n    }\r\n};\r\n</script>\r\n"],"mappings":"AAkMA,SACAA,aAAA,EACAC,cAAA,EACAC,gBAAA,EACAC,gBAAA,EACAC,iBAAA,EACAC,mBAAA,QACA;AACA,OAAAC,UAAA;AACA,OAAAC,IAAA;AACA;EACAC,IAAA;EACAC,UAAA;IACAH;EACA;EACAI,KAAA;IACA;MACAC,uBAAA;MACAC,OAAA;MACAC,MAAA;MACAC,SAAA;MACAC,gBAAA;MACAC,gBAAA;MACAC,UAAA;MACAC,WAAA;MACAC,UAAA;MACAC,SAAA;MACAC,WAAA;MACAC,SAAA;MACAC,UAAA;MACAC,IAAA;QACAC,EAAA;QACAC,KAAA;QACAlB,IAAA;QACAmB,IAAA;QACAC,IAAA;QACAC,SAAA;QACAC,QAAA;QACAC,UAAA;QACAC,IAAA;QACAC,SAAA;QACAC,KAAA;QACAC,MAAA;QACAC,GAAA;MACA;MACAC,OAAA;QACAN,UAAA;MACA;MACAO,YAAA;QACAZ,KAAA;UACAa,QAAA;UACAC,OAAA;UACAC,OAAA;QACA;QACAjC,IAAA;UACA+B,QAAA;UACAC,OAAA;UACAC,OAAA;QACA;QACAd,IAAA;UACAY,QAAA;UACAC,OAAA;UACAC,OAAA;QACA;QACAb,IAAA;UACAW,QAAA;UACAC,OAAA;UACAC,OAAA;QACA;QACAZ,SAAA;UACAU,QAAA;UACAC,OAAA;UACAC,OAAA;QACA;QACAR,SAAA;UACAM,QAAA;UACAP,IAAA;UACAQ,OAAA;UACAC,OAAA;QACA;MACA;MACAC,aAAA;MACAhC,IAAA;MACAiC,eAAA;MACAC,oBAAA;MACAC,uBAAA;QACAnB,KAAA;QACAoB,GAAA;QACAC,QAAA;QACAC,OAAA;QACAC,QAAA;MACA;QACAvB,KAAA;QACAoB,GAAA;QACAC,QAAA;QACAC,OAAA;QACAC,QAAA;MACA;QACAvB,KAAA;QACAoB,GAAA;QACAC,QAAA;QACAC,OAAA;QACAC,QAAA;MACA;QACAvB,KAAA;QACAoB,GAAA;QACAC,QAAA;QACAC,OAAA;QACAC,QAAA;MACA;QACAvB,KAAA;QACAoB,GAAA;QACAC,QAAA;QACAC,OAAA;QACAC,QAAA;MACA;IACA;EA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"},"metadata":{},"sourceType":"module","externalDependencies":[]}