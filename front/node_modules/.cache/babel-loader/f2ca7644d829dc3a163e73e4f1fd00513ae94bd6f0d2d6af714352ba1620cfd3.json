{"ast":null,"code":"import { getUserListData } from \"@/api/index\";\nimport departmentChoose from \"./department-choose\";\nexport default {\n  name: \"userChoose\",\n  components: {\n    departmentChoose\n  },\n  props: {\n    text: {\n      type: String,\n      default: \"选择用户\"\n    },\n    icon: {\n      type: String,\n      default: \"md-person-add\"\n    }\n  },\n  data() {\n    return {\n      userLoading: true,\n      userModalVisible: false,\n      selectUsers: [],\n      searchUserForm: {\n        id: \"\",\n        nickname: \"\",\n        type: \"\",\n        status: \"\",\n        pageNumber: 1,\n        // 当前页数\n        pageSize: 10,\n        // 页面大小\n        sort: \"createTime\",\n        // 默认排序字段\n        order: \"desc\" // 默认排序方式\n      },\n      userColumns: [{\n        type: \"index\",\n        width: 60,\n        align: \"center\"\n      }, {\n        title: \"用户名\",\n        key: \"nickname\",\n        minWidth: 130,\n        sortable: true\n      }, {\n        title: \"登录账号\",\n        key: \"username\",\n        minWidth: 130,\n        sortable: true\n      }, {\n        title: \"头像\",\n        key: \"avatar\",\n        width: 80,\n        align: \"center\",\n        render: (h, params) => {\n          return h(\"Avatar\", {\n            props: {\n              src: params.row.avatar\n            }\n          });\n        }\n      }, {\n        title: \"所属部门\",\n        key: \"departmentTitle\",\n        width: 120\n      }, {\n        title: \"手机\",\n        key: \"mobile\",\n        width: 125,\n        sortable: true\n      }, {\n        title: \"邮箱\",\n        key: \"email\",\n        width: 180,\n        sortable: true\n      }, {\n        title: \"性别\",\n        key: \"sex\",\n        width: 70,\n        align: \"center\"\n      }, {\n        title: \"创建时间\",\n        key: \"createTime\",\n        sortable: true,\n        sortType: \"desc\",\n        width: 170\n      }, {\n        title: \"操作\",\n        key: \"action\",\n        width: 130,\n        align: \"center\",\n        fixed: \"right\",\n        render: (h, params) => {\n          return h(\"div\", [h(\"Button\", {\n            props: {\n              type: \"info\",\n              size: \"small\"\n            },\n            on: {\n              click: () => {\n                this.chooseUser(params.row);\n              }\n            }\n          }, \"添加该用户\")]);\n        }\n      }],\n      userData: [],\n      totalUser: 0\n    };\n  },\n  methods: {\n    handleSelectDep(v) {\n      this.searchUserForm.departmentId = v;\n    },\n    changeUserPage(v) {\n      this.searchUserForm.pageNumber = v;\n      this.getUserDataList();\n    },\n    changeUserPageSize(v) {\n      this.searchUserForm.pageSize = v;\n      this.getUserDataList();\n    },\n    getUserDataList() {\n      this.userLoading = true;\n      getUserListData(this.searchUserForm).then(res => {\n        this.userLoading = false;\n        if (res.success) {\n          this.userData = res.result.records;\n          this.totalUser = res.result.total;\n        }\n      });\n    },\n    handleSearchUser() {\n      this.searchUserForm.pageNumber = 1;\n      this.searchUserForm.pageSize = 10;\n      this.getUserDataList();\n    },\n    handleResetUser() {\n      this.$refs.searchUserForm.resetFields();\n      this.searchUserForm.pageNumber = 1;\n      this.searchUserForm.pageSize = 10;\n      this.$refs.dep.clearSelect();\n      this.searchUserForm.departmentId = \"\";\n      // 重新加载数据\n      this.getUserDataList();\n    },\n    setData(v) {\n      this.selectUsers = v;\n      this.$emit(\"on-change\", this.selectUsers);\n    },\n    chooseUser(v) {\n      // 去重\n      let that = this;\n      let flag = true;\n      this.selectUsers.forEach(e => {\n        if (v.id == e.id) {\n          that.$Message.warning(\"已经添加过啦，请勿重复选择\");\n          flag = false;\n        }\n      });\n      if (flag) {\n        let u = {\n          id: v.id,\n          username: v.username,\n          nickname: v.nickname\n        };\n        this.selectUsers.push(u);\n        this.$emit(\"on-change\", this.selectUsers);\n        this.$Message.success(`添加用户 ${v.nickname} 成功`);\n      }\n    },\n    clearSelectData() {\n      this.selectUsers = [];\n      this.$emit(\"on-change\", this.selectUsers);\n    },\n    handleCancelUser(e, id) {\n      // 删除所选用户\n      this.selectUsers = this.selectUsers.filter(e => {\n        return e.id != id;\n      });\n      this.$emit(\"on-change\", this.selectUsers);\n      this.$Message.success(\"删除所选用户成功\");\n    }\n  },\n  mounted() {\n    this.getUserDataList();\n  }\n};","map":{"version":3,"names":["getUserListData","departmentChoose","name","components","props","text","type","String","default","icon","data","userLoading","userModalVisible","selectUsers","searchUserForm","id","nickname","status","pageNumber","pageSize","sort","order","userColumns","width","align","title","key","minWidth","sortable","render","h","params","src","row","avatar","sortType","fixed","size","on","click","chooseUser","userData","totalUser","methods","handleSelectDep","v","departmentId","changeUserPage","getUserDataList","changeUserPageSize","then","res","success","result","records","total","handleSearchUser","handleResetUser","$refs","resetFields","dep","clearSelect","setData","$emit","that","flag","forEach","e","$Message","warning","u","username","push","clearSelectData","handleCancelUser","filter","mounted"],"sources":["src/views/template/user-choose.vue"],"sourcesContent":["<template>\r\n<div class=\"user-choose\">\r\n    <Button @click=\"userModalVisible=true\" :icon=\"icon\">{{text}}</Button>\r\n    <span @click=\"clearSelectData\" class=\"clear\">清空已选</span>\r\n    <Collapse simple class=\"collapse\">\r\n        <Panel name=\"1\">\r\n            已选择\r\n            <span class=\"select-count\">{{selectUsers.length}}</span> 人\r\n            <p slot=\"content\">\r\n                <Tag v-for=\"(item, i) in selectUsers\" :key=\"i\" :name=\"item.id\" color=\"default\" closable @on-close=\"handleCancelUser\">\r\n                    <Tooltip placement=\"top\" :content=\"item.username\">{{item.nickname}}</Tooltip>\r\n                </Tag>\r\n            </p>\r\n        </Panel>\r\n    </Collapse>\r\n    <Drawer title=\"选择用户\" closable v-model=\"userModalVisible\" width=\"800\" draggable>\r\n        <Form ref=\"searchUserForm\" :model=\"searchUserForm\" inline :label-width=\"55\">\r\n            <Form-item label=\"用户名\" prop=\"nickname\">\r\n                <Input type=\"text\" v-model=\"searchUserForm.nickname\" clearable placeholder=\"请输入用户名\" style=\"width: 200px\" />\r\n            </Form-item>\r\n            <Form-item label=\"部门\" prop=\"department\">\r\n                <department-choose @on-change=\"handleSelectDep\" style=\"width: 200px\" ref=\"dep\"></department-choose>\r\n            </Form-item>\r\n            <Form-item style=\"margin-left:-35px;\" class=\"br\">\r\n                <Button @click=\"handleSearchUser\" type=\"primary\" icon=\"ios-search\">搜索</Button>\r\n                <Button @click=\"handleResetUser\">重置</Button>\r\n            </Form-item>\r\n        </Form>\r\n        <Alert show-icon>\r\n            已选择\r\n            <span class=\"select-count\">{{selectUsers.length}}</span> 项\r\n            <a style=\"margin-left: 10px;\" @click=\"clearSelectData\">清空已选</a>\r\n        </Alert>\r\n        <Table :loading=\"userLoading\" border :columns=\"userColumns\" :data=\"userData\" style=\"margin: 2vh 0;\"></Table>\r\n        <Row type=\"flex\" justify=\"end\">\r\n            <Page :current=\"searchUserForm.pageNumber\" :total=\"totalUser\" :page-size=\"searchUserForm.pageSize\" @on-change=\"changeUserPage\" @on-page-size-change=\"changeUserPageSize\" :page-size-opts=\"[10,20,50]\" size=\"small\" show-total show-elevator show-sizer transfer></Page>\r\n        </Row>\r\n    </Drawer>\r\n</div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n    getUserListData\r\n} from \"@/api/index\";\r\nimport departmentChoose from \"./department-choose\";\r\nexport default {\r\n    name: \"userChoose\",\r\n    components: {\r\n        departmentChoose\r\n    },\r\n    props: {\r\n        text: {\r\n            type: String,\r\n            default: \"选择用户\"\r\n        },\r\n        icon: {\r\n            type: String,\r\n            default: \"md-person-add\"\r\n        }\r\n    },\r\n    data() {\r\n        return {\r\n            userLoading: true,\r\n            userModalVisible: false,\r\n            selectUsers: [],\r\n            searchUserForm: {\r\n                id: \"\",\r\n                nickname: \"\",\r\n                type: \"\",\r\n                status: \"\",\r\n                pageNumber: 1, // 当前页数\r\n                pageSize: 10, // 页面大小\r\n                sort: \"createTime\", // 默认排序字段\r\n                order: \"desc\" // 默认排序方式\r\n            },\r\n            userColumns: [{\r\n                    type: \"index\",\r\n                    width: 60,\r\n                    align: \"center\"\r\n                },\r\n                {\r\n                    title: \"用户名\",\r\n                    key: \"nickname\",\r\n                    minWidth: 130,\r\n                    sortable: true\r\n                },\r\n                {\r\n                    title: \"登录账号\",\r\n                    key: \"username\",\r\n                    minWidth: 130,\r\n                    sortable: true\r\n                },\r\n                {\r\n                    title: \"头像\",\r\n                    key: \"avatar\",\r\n                    width: 80,\r\n                    align: \"center\",\r\n                    render: (h, params) => {\r\n                        return h(\"Avatar\", {\r\n                            props: {\r\n                                src: params.row.avatar\r\n                            }\r\n                        });\r\n                    }\r\n                },\r\n                {\r\n                    title: \"所属部门\",\r\n                    key: \"departmentTitle\",\r\n                    width: 120\r\n                },\r\n                {\r\n                    title: \"手机\",\r\n                    key: \"mobile\",\r\n                    width: 125,\r\n                    sortable: true\r\n                },\r\n                {\r\n                    title: \"邮箱\",\r\n                    key: \"email\",\r\n                    width: 180,\r\n                    sortable: true\r\n                },\r\n                {\r\n                    title: \"性别\",\r\n                    key: \"sex\",\r\n                    width: 70,\r\n                    align: \"center\"\r\n                },\r\n                {\r\n                    title: \"创建时间\",\r\n                    key: \"createTime\",\r\n                    sortable: true,\r\n                    sortType: \"desc\",\r\n                    width: 170\r\n                },\r\n                {\r\n                    title: \"操作\",\r\n                    key: \"action\",\r\n                    width: 130,\r\n                    align: \"center\",\r\n                    fixed: \"right\",\r\n                    render: (h, params) => {\r\n                        return h(\"div\", [\r\n                            h(\r\n                                \"Button\", {\r\n                                    props: {\r\n                                        type: \"info\",\r\n                                        size: \"small\"\r\n                                    },\r\n                                    on: {\r\n                                        click: () => {\r\n                                            this.chooseUser(params.row);\r\n                                        }\r\n                                    }\r\n                                },\r\n                                \"添加该用户\"\r\n                            )\r\n                        ]);\r\n                    }\r\n                }\r\n            ],\r\n            userData: [],\r\n            totalUser: 0\r\n        };\r\n    },\r\n    methods: {\r\n        handleSelectDep(v) {\r\n            this.searchUserForm.departmentId = v;\r\n        },\r\n        changeUserPage(v) {\r\n            this.searchUserForm.pageNumber = v;\r\n            this.getUserDataList();\r\n        },\r\n        changeUserPageSize(v) {\r\n            this.searchUserForm.pageSize = v;\r\n            this.getUserDataList();\r\n        },\r\n        getUserDataList() {\r\n            this.userLoading = true;\r\n            getUserListData(this.searchUserForm).then(res => {\r\n                this.userLoading = false;\r\n                if (res.success) {\r\n                    this.userData = res.result.records;\r\n                    this.totalUser = res.result.total;\r\n                }\r\n            });\r\n        },\r\n        handleSearchUser() {\r\n            this.searchUserForm.pageNumber = 1;\r\n            this.searchUserForm.pageSize = 10;\r\n            this.getUserDataList();\r\n        },\r\n        handleResetUser() {\r\n            this.$refs.searchUserForm.resetFields();\r\n            this.searchUserForm.pageNumber = 1;\r\n            this.searchUserForm.pageSize = 10;\r\n            this.$refs.dep.clearSelect();\r\n            this.searchUserForm.departmentId = \"\";\r\n            // 重新加载数据\r\n            this.getUserDataList();\r\n        },\r\n        setData(v) {\r\n            this.selectUsers = v;\r\n            this.$emit(\"on-change\", this.selectUsers);\r\n        },\r\n        chooseUser(v) {\r\n            // 去重\r\n            let that = this;\r\n            let flag = true;\r\n            this.selectUsers.forEach(e => {\r\n                if (v.id == e.id) {\r\n                    that.$Message.warning(\"已经添加过啦，请勿重复选择\");\r\n                    flag = false;\r\n                }\r\n            });\r\n            if (flag) {\r\n                let u = {\r\n                    id: v.id,\r\n                    username: v.username,\r\n                    nickname: v.nickname\r\n                };\r\n                this.selectUsers.push(u);\r\n                this.$emit(\"on-change\", this.selectUsers);\r\n                this.$Message.success(`添加用户 ${v.nickname} 成功`);\r\n            }\r\n        },\r\n        clearSelectData() {\r\n            this.selectUsers = [];\r\n            this.$emit(\"on-change\", this.selectUsers);\r\n        },\r\n        handleCancelUser(e, id) {\r\n            // 删除所选用户\r\n            this.selectUsers = this.selectUsers.filter(e => {\r\n                return e.id != id;\r\n            });\r\n            this.$emit(\"on-change\", this.selectUsers);\r\n            this.$Message.success(\"删除所选用户成功\");\r\n        }\r\n    },\r\n    mounted() {\r\n        this.getUserDataList();\r\n    }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\">\r\n.user-choose {\r\n    .clear {\r\n        font-size: 12px;\r\n        margin-left: 15px;\r\n        color: #40a9ff;\r\n        cursor: pointer;\r\n    }\r\n\r\n    .collapse {\r\n        font-size: 12px;\r\n        margin-top: 15px;\r\n        width: 500px;\r\n    }\r\n\r\n    .select-count {\r\n        font-weight: 600;\r\n        color: #40a9ff;\r\n    }\r\n}\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}