{"version":3,"file":"createWorker.js","sourceRoot":"","sources":["../../../../src/geometry/label/util/createWorker.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,UAAU,EAAE,MAAM,YAAY,CAAC;AAExC;IAIE,kBAAY,GAAG;QAAf,iBASC;QAZD,UAAK,GAAU,EAAE,CAAC;QAIhB,IAAI,CAAC,MAAM,GAAG,IAAI,MAAM,CAAC,GAAG,CAAC,CAAC;QAC9B,IAAI,CAAC,MAAM,CAAC,SAAS,GAAG,UAAC,CAAe;;YACtC,MAAA,KAAI,CAAC,KAAK,CAAC,KAAK,EAAE,0CAAE,OAAO,CAAC,CAAC,CAAC,CAAC;QACjC,CAAC,CAAC;QACF,IAAI,CAAC,MAAM,CAAC,cAAc,GAAG,UAAC,CAAe;;YAC3C,OAAO,CAAC,IAAI,CAAC,uCAAuC,CAAC,CAAC;YACtD,MAAA,KAAI,CAAC,KAAK,CAAC,KAAK,EAAE,0CAAE,MAAM,CAAC,CAAC,CAAC,CAAC;QAChC,CAAC,CAAC;IACJ,CAAC;IAED,uBAAI,GAAJ,UAAK,MAAM,EAAE,OAAmB;QAAhC,iBAUC;QATC,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YACjC,KAAI,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,OAAO,SAAA,EAAE,MAAM,QAAA,EAAE,CAAC,CAAC;YACrC,IAAI;gBACF,KAAI,CAAC,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;aACjC;YAAC,OAAO,CAAC,EAAE;gBACV,OAAO,CAAC,IAAI,CAAC,uCAAuC,CAAC,CAAC;gBACtD,UAAU,CAAC,OAAO,CAAC,IAAI,OAAO,EAAE,CAAC;aAClC;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAED,0BAAO,GAAP;QACE,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC;IAC1B,CAAC;IACH,eAAC;AAAD,CAAC,AA9BD,IA8BC;AAED,MAAM,UAAU,YAAY,CAAC,CAAM;IACjC,IAAI,OAAO,MAAM,KAAK,WAAW;QAAE,OAAO;IAE1C,IAAI,IAAI,CAAC;IACT,IAAI;QACF,IAAI,GAAG,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,EAAE,EAAE,IAAI,EAAE,wBAAwB,EAAE,CAAC,CAAC;KACrE;IAAC,OAAO,CAAC,EAAE;QACV,aAAa;QACb,IAAI,GAAG,IAAI,MAAM,CAAC,WAAW,EAAE,CAAC;QAChC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC;QAC1B,IAAI,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;KACvB;IAED,OAAO,IAAI,QAAQ,CAAC,GAAG,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC,CAAC;AACjD,CAAC","sourcesContent":["import { isFunction } from '@antv/util';\n\nclass MyWorker {\n  queue: any[] = [];\n  worker: Worker;\n\n  constructor(url) {\n    this.worker = new Worker(url);\n    this.worker.onmessage = (e: MessageEvent) => {\n      this.queue.shift()?.resolve(e);\n    };\n    this.worker.onmessageerror = (e: MessageEvent) => {\n      console.warn('[AntV G2] Web worker is not available');\n      this.queue.shift()?.reject(e);\n    };\n  }\n\n  post(params, onError?: () => any): Promise<MessageEvent> {\n    return new Promise((resolve, reject) => {\n      this.queue.push({ resolve, reject });\n      try {\n        this.worker.postMessage(params);\n      } catch (e) {\n        console.warn('[AntV G2] Web worker is not available');\n        isFunction(onError) && onError();\n      }\n    });\n  }\n\n  destroy() {\n    this.worker.terminate();\n  }\n}\n\nexport function createWorker(f: any) {\n  if (typeof window === 'undefined') return;\n\n  let blob;\n  try {\n    blob = new Blob([f.toString()], { type: 'application/javascript' });\n  } catch (e) {\n    // @ts-ignore\n    blob = new window.BlobBuilder();\n    blob.append(f.toString());\n    blob = blob.getBlob();\n  }\n\n  return new MyWorker(URL.createObjectURL(blob));\n}\n"]}